{"version":3,"sources":["../src/index.ts","../src/api/endpoints/AbstractApi.ts","../src/util/path.ts","../src/api/endpoints/AllowlistIdentifierApi.ts","../src/api/endpoints/ClientApi.ts","../src/api/endpoints/DomainApi.ts","../src/api/endpoints/EmailAddressApi.ts","../src/api/endpoints/EmailApi.ts","../src/api/endpoints/InterstitialApi.ts","../src/api/endpoints/InvitationApi.ts","../src/api/endpoints/OrganizationApi.ts","../src/api/endpoints/PhoneNumberApi.ts","../src/api/endpoints/RedirectUrlApi.ts","../src/api/endpoints/SessionApi.ts","../src/api/endpoints/SignInTokenApi.ts","../src/api/endpoints/SMSMessageApi.ts","../src/api/endpoints/UserApi.ts","../src/api/request.ts","../src/constants.ts","../src/runtime/index.ts","../src/util/assertValidSecretKey.ts","../src/api/resources/AllowlistIdentifier.ts","../src/api/resources/Session.ts","../src/api/resources/Client.ts","../src/api/resources/DeletedObject.ts","../src/api/resources/Email.ts","../src/api/resources/IdentificationLink.ts","../src/api/resources/Verification.ts","../src/api/resources/EmailAddress.ts","../src/api/resources/ExternalAccount.ts","../src/api/resources/Invitation.ts","../src/api/resources/JSON.ts","../src/api/resources/OauthAccessToken.ts","../src/api/resources/Organization.ts","../src/api/resources/OrganizationInvitation.ts","../src/api/resources/OrganizationMembership.ts","../src/api/resources/PhoneNumber.ts","../src/api/resources/RedirectUrl.ts","../src/api/resources/SignInTokens.ts","../src/api/resources/SMSMessage.ts","../src/api/resources/Token.ts","../src/api/resources/Web3Wallet.ts","../src/api/resources/User.ts","../src/api/resources/Deserializer.ts","../src/api/factory.ts","../src/tokens/authObjects.ts","../src/util/callWithRetry.ts","../src/util/instance.ts","../src/util/isDevOrStagingUrl.ts","../src/util/parsePublishableKey.ts","../src/tokens/errors.ts","../src/tokens/interstitial.ts","../src/tokens/authStatus.ts","../src/util/request.ts","../src/util/rfc4648.ts","../src/tokens/jwt/assertions.ts","../src/tokens/jwt/verifyJwt.ts","../src/tokens/keys.ts","../src/tokens/verify.ts","../src/tokens/interstitialRule.ts","../src/tokens/request.ts","../src/tokens/factory.ts","../src/redirections.ts"],"sourcesContent":["import type { CreateBackendApiOptions } from './api';\nimport { createBackendApiClient } from './api';\nimport type { CreateAuthenticateRequestOptions } from './tokens';\nimport { createAuthenticateRequest } from './tokens';\n\nexport * from './api/resources';\nexport * from './tokens';\nexport * from './tokens/jwt';\nexport * from './tokens/verify';\nexport { constants } from './constants';\nexport { redirect } from './redirections';\n\nexport type ClerkOptions = CreateBackendApiOptions &\n  Partial<\n    Pick<\n      CreateAuthenticateRequestOptions['options'],\n      'audience' | 'jwtKey' | 'proxyUrl' | 'secretKey' | 'publishableKey' | 'domain' | 'isSatellite'\n    >\n  >;\n\nexport function Clerk(options: ClerkOptions) {\n  const opts = { ...options };\n  const apiClient = createBackendApiClient(opts);\n  const requestState = createAuthenticateRequest({ options: opts, apiClient });\n\n  return {\n    ...apiClient,\n    ...requestState,\n    /**\n     * @deprecated This prop has been deprecated and will be removed in the next major release.\n     */\n    __unstable_options: opts,\n  };\n}\n","import type { RequestFunction } from '../request';\n\nexport abstract class AbstractAPI {\n  constructor(protected request: RequestFunction) {}\n\n  protected requireId(id: string) {\n    if (!id) {\n      throw new Error('A valid resource ID is required.');\n    }\n  }\n}\n","const SEPARATOR = '/';\nconst MULTIPLE_SEPARATOR_REGEX = new RegExp(SEPARATOR + '{1,}', 'g');\n\ntype PathString = string | null | undefined;\n\nexport function joinPaths(...args: PathString[]): string {\n  return args\n    .filter(p => p)\n    .join(SEPARATOR)\n    .replace(MULTIPLE_SEPARATOR_REGEX, SEPARATOR);\n}\n","import { joinPaths } from '../../util/path';\nimport type { AllowlistIdentifier } from '../resources/AllowlistIdentifier';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/allowlist_identifiers';\n\ntype AllowlistIdentifierCreateParams = {\n  identifier: string;\n  notify: boolean;\n};\n\nexport class AllowlistIdentifierAPI extends AbstractAPI {\n  public async getAllowlistIdentifierList() {\n    return this.request<AllowlistIdentifier[]>({\n      method: 'GET',\n      path: basePath,\n    });\n  }\n\n  public async createAllowlistIdentifier(params: AllowlistIdentifierCreateParams) {\n    return this.request<AllowlistIdentifier>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async deleteAllowlistIdentifier(allowlistIdentifierId: string) {\n    this.requireId(allowlistIdentifierId);\n    return this.request<AllowlistIdentifier>({\n      method: 'DELETE',\n      path: joinPaths(basePath, allowlistIdentifierId),\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { Client } from '../resources/Client';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/clients';\n\nexport class ClientAPI extends AbstractAPI {\n  public async getClientList() {\n    return this.request<Client[]>({\n      method: 'GET',\n      path: basePath,\n    });\n  }\n\n  public async getClient(clientId: string) {\n    this.requireId(clientId);\n    return this.request<Client>({\n      method: 'GET',\n      path: joinPaths(basePath, clientId),\n    });\n  }\n\n  public verifyClient(token: string) {\n    return this.request<Client>({\n      method: 'POST',\n      path: joinPaths(basePath, 'verify'),\n      bodyParams: { token },\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { DeletedObject } from '../resources/DeletedObject';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/domains';\n\nexport class DomainAPI extends AbstractAPI {\n  public async deleteDomain(id: string) {\n    return this.request<DeletedObject>({\n      method: 'DELETE',\n      path: joinPaths(basePath, id),\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { DeletedObject, EmailAddress } from '../resources';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/email_addresses';\n\ntype CreateEmailAddressParams = {\n  userId: string;\n  emailAddress: string;\n  verified?: boolean;\n  primary?: boolean;\n};\n\ntype UpdateEmailAddressParams = {\n  verified?: boolean;\n  primary?: boolean;\n};\n\nexport class EmailAddressAPI extends AbstractAPI {\n  public async getEmailAddress(emailAddressId: string) {\n    this.requireId(emailAddressId);\n\n    return this.request<EmailAddress>({\n      method: 'GET',\n      path: joinPaths(basePath, emailAddressId),\n    });\n  }\n\n  public async createEmailAddress(params: CreateEmailAddressParams) {\n    return this.request<EmailAddress>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async updateEmailAddress(emailAddressId: string, params: UpdateEmailAddressParams = {}) {\n    this.requireId(emailAddressId);\n\n    return this.request<EmailAddress>({\n      method: 'PATCH',\n      path: joinPaths(basePath, emailAddressId),\n      bodyParams: params,\n    });\n  }\n\n  public async deleteEmailAddress(emailAddressId: string) {\n    this.requireId(emailAddressId);\n\n    return this.request<DeletedObject>({\n      method: 'DELETE',\n      path: joinPaths(basePath, emailAddressId),\n    });\n  }\n}\n","import type { Email } from '../resources/Email';\nimport { AbstractAPI } from './AbstractApi';\n\ntype EmailParams = {\n  fromEmailName: string;\n  emailAddressId: string;\n  subject: string;\n  body: string;\n};\n\nconst basePath = '/emails';\n\nexport class EmailAPI extends AbstractAPI {\n  public async createEmail(params: EmailParams) {\n    return this.request<Email>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n}\n","import { AbstractAPI } from './AbstractApi';\n\n/**\n * @deprecated Switch to the public interstitial endpoint from Clerk Backend API.\n */\nexport class InterstitialAPI extends AbstractAPI {\n  public async getInterstitial() {\n    return this.request<string>({\n      path: 'internal/interstitial',\n      method: 'GET',\n      headerParams: {\n        'Content-Type': 'text/html',\n      },\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { Invitation } from '../resources/Invitation';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/invitations';\n\ntype CreateParams = {\n  emailAddress: string;\n  redirectUrl?: string;\n  publicMetadata?: UserPublicMetadata;\n};\n\nexport class InvitationAPI extends AbstractAPI {\n  public async getInvitationList() {\n    return this.request<Invitation[]>({\n      method: 'GET',\n      path: basePath,\n    });\n  }\n\n  public async createInvitation(params: CreateParams) {\n    return this.request<Invitation>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async revokeInvitation(invitationId: string) {\n    this.requireId(invitationId);\n    return this.request<Invitation>({\n      method: 'POST',\n      path: joinPaths(basePath, invitationId, 'revoke'),\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { Organization, OrganizationInvitation, OrganizationMembership } from '../resources';\nimport type { OrganizationMembershipRole } from '../resources/Enums';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/organizations';\n\ntype MetadataParams<TPublic = OrganizationPublicMetadata, TPrivate = OrganizationPrivateMetadata> = {\n  publicMetadata?: TPublic;\n  privateMetadata?: TPrivate;\n};\n\ntype GetOrganizationListParams = {\n  limit?: number;\n  offset?: number;\n  includeMembersCount?: boolean;\n  query?: string;\n};\n\ntype CreateParams = {\n  name: string;\n  slug?: string;\n  /* The User id for the user creating the organization. The user will become an administrator for the organization. */\n  createdBy: string;\n  maxAllowedMemberships?: number;\n} & MetadataParams;\n\ntype GetOrganizationParams = { organizationId: string } | { slug: string };\n\ntype UpdateParams = {\n  name?: string;\n  slug?: string;\n  maxAllowedMemberships?: number;\n} & MetadataParams;\n\ntype UpdateMetadataParams = MetadataParams;\n\ntype GetOrganizationMembershipListParams = {\n  organizationId: string;\n  limit?: number;\n  offset?: number;\n};\n\ntype CreateOrganizationMembershipParams = {\n  organizationId: string;\n  userId: string;\n  role: OrganizationMembershipRole;\n};\n\ntype UpdateOrganizationMembershipParams = CreateOrganizationMembershipParams;\n\ntype UpdateOrganizationMembershipMetadataParams = {\n  organizationId: string;\n  userId: string;\n} & MetadataParams<OrganizationMembershipPublicMetadata>;\n\ntype DeleteOrganizationMembershipParams = {\n  organizationId: string;\n  userId: string;\n};\n\ntype CreateOrganizationInvitationParams = {\n  organizationId: string;\n  inviterUserId: string;\n  emailAddress: string;\n  role: OrganizationMembershipRole;\n  redirectUrl?: string;\n  publicMetadata?: OrganizationInvitationPublicMetadata;\n};\n\ntype GetPendingOrganizationInvitationListParams = {\n  organizationId: string;\n  limit?: number;\n  offset?: number;\n};\n\ntype RevokeOrganizationInvitationParams = {\n  organizationId: string;\n  invitationId: string;\n  requestingUserId: string;\n};\n\nexport class OrganizationAPI extends AbstractAPI {\n  public async getOrganizationList(params?: GetOrganizationListParams) {\n    return this.request<Organization[]>({\n      method: 'GET',\n      path: basePath,\n      queryParams: params,\n    });\n  }\n\n  public async createOrganization(params: CreateParams) {\n    return this.request<Organization>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async getOrganization(params: GetOrganizationParams) {\n    const organizationIdOrSlug = 'organizationId' in params ? params.organizationId : params.slug;\n    this.requireId(organizationIdOrSlug);\n\n    return this.request<Organization>({\n      method: 'GET',\n      path: joinPaths(basePath, organizationIdOrSlug),\n    });\n  }\n\n  public async updateOrganization(organizationId: string, params: UpdateParams) {\n    this.requireId(organizationId);\n    return this.request<Organization>({\n      method: 'PATCH',\n      path: joinPaths(basePath, organizationId),\n      bodyParams: params,\n    });\n  }\n\n  public async updateOrganizationMetadata(organizationId: string, params: UpdateMetadataParams) {\n    this.requireId(organizationId);\n\n    return this.request<Organization>({\n      method: 'PATCH',\n      path: joinPaths(basePath, organizationId, 'metadata'),\n      bodyParams: params,\n    });\n  }\n\n  public async deleteOrganization(organizationId: string) {\n    return this.request<Organization>({\n      method: 'DELETE',\n      path: joinPaths(basePath, organizationId),\n    });\n  }\n\n  public async getOrganizationMembershipList(params: GetOrganizationMembershipListParams) {\n    const { organizationId, limit, offset } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationMembership[]>({\n      method: 'GET',\n      path: joinPaths(basePath, organizationId, 'memberships'),\n      queryParams: { limit, offset },\n    });\n  }\n\n  public async createOrganizationMembership(params: CreateOrganizationMembershipParams) {\n    const { organizationId, userId, role } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationMembership>({\n      method: 'POST',\n      path: joinPaths(basePath, organizationId, 'memberships'),\n      bodyParams: {\n        userId,\n        role,\n      },\n    });\n  }\n\n  public async updateOrganizationMembership(params: UpdateOrganizationMembershipParams) {\n    const { organizationId, userId, role } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationMembership>({\n      method: 'PATCH',\n      path: joinPaths(basePath, organizationId, 'memberships', userId),\n      bodyParams: {\n        role,\n      },\n    });\n  }\n\n  public async updateOrganizationMembershipMetadata(params: UpdateOrganizationMembershipMetadataParams) {\n    const { organizationId, userId, publicMetadata, privateMetadata } = params;\n\n    return this.request<OrganizationMembership>({\n      method: 'PATCH',\n      path: joinPaths(basePath, organizationId, 'memberships', userId, 'metadata'),\n      bodyParams: {\n        publicMetadata,\n        privateMetadata,\n      },\n    });\n  }\n\n  public async deleteOrganizationMembership(params: DeleteOrganizationMembershipParams) {\n    const { organizationId, userId } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationMembership>({\n      method: 'DELETE',\n      path: joinPaths(basePath, organizationId, 'memberships', userId),\n    });\n  }\n\n  public async getPendingOrganizationInvitationList(params: GetPendingOrganizationInvitationListParams) {\n    const { organizationId, limit, offset } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationInvitation[]>({\n      method: 'GET',\n      path: joinPaths(basePath, organizationId, 'invitations', 'pending'),\n      queryParams: { limit, offset },\n    });\n  }\n\n  public async createOrganizationInvitation(params: CreateOrganizationInvitationParams) {\n    const { organizationId, ...bodyParams } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationInvitation>({\n      method: 'POST',\n      path: joinPaths(basePath, organizationId, 'invitations'),\n      bodyParams: { ...bodyParams },\n    });\n  }\n\n  public async revokeOrganizationInvitation(params: RevokeOrganizationInvitationParams) {\n    const { organizationId, invitationId, requestingUserId } = params;\n    this.requireId(organizationId);\n\n    return this.request<OrganizationInvitation>({\n      method: 'POST',\n      path: joinPaths(basePath, organizationId, 'invitations', invitationId, 'revoke'),\n      bodyParams: {\n        requestingUserId,\n      },\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { DeletedObject, PhoneNumber } from '../resources';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/phone_numbers';\n\ntype CreatePhoneNumberParams = {\n  userId: string;\n  phoneNumber: string;\n  verified?: boolean;\n  primary?: boolean;\n};\n\ntype UpdatePhoneNumberParams = {\n  verified?: boolean;\n  primary?: boolean;\n};\n\nexport class PhoneNumberAPI extends AbstractAPI {\n  public async getPhoneNumber(phoneNumberId: string) {\n    this.requireId(phoneNumberId);\n\n    return this.request<PhoneNumber>({\n      method: 'GET',\n      path: joinPaths(basePath, phoneNumberId),\n    });\n  }\n\n  public async createPhoneNumber(params: CreatePhoneNumberParams) {\n    return this.request<PhoneNumber>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async updatePhoneNumber(phoneNumberId: string, params: UpdatePhoneNumberParams = {}) {\n    this.requireId(phoneNumberId);\n\n    return this.request<PhoneNumber>({\n      method: 'PATCH',\n      path: joinPaths(basePath, phoneNumberId),\n      bodyParams: params,\n    });\n  }\n\n  public async deletePhoneNumber(phoneNumberId: string) {\n    this.requireId(phoneNumberId);\n\n    return this.request<DeletedObject>({\n      method: 'DELETE',\n      path: joinPaths(basePath, phoneNumberId),\n    });\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { RedirectUrl } from '../resources/RedirectUrl';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/redirect_urls';\n\ntype CreateRedirectUrlParams = {\n  url: string;\n};\n\nexport class RedirectUrlAPI extends AbstractAPI {\n  public async getRedirectUrlList() {\n    return this.request<RedirectUrl[]>({\n      method: 'GET',\n      path: basePath,\n    });\n  }\n\n  public async getRedirectUrl(redirectUrlId: string) {\n    this.requireId(redirectUrlId);\n    return this.request<RedirectUrl>({\n      method: 'GET',\n      path: joinPaths(basePath, redirectUrlId),\n    });\n  }\n\n  public async createRedirectUrl(params: CreateRedirectUrlParams) {\n    return this.request<RedirectUrl>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async deleteRedirectUrl(redirectUrlId: string) {\n    this.requireId(redirectUrlId);\n    return this.request<RedirectUrl>({\n      method: 'DELETE',\n      path: joinPaths(basePath, redirectUrlId),\n    });\n  }\n}\n","import type { SessionStatus } from '@clerk/types';\n\nimport { joinPaths } from '../../util/path';\nimport type { Session } from '../resources/Session';\nimport type { Token } from '../resources/Token';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/sessions';\n\ntype QueryParams = {\n  clientId?: string;\n  userId?: string;\n  status?: SessionStatus;\n};\n\nexport class SessionAPI extends AbstractAPI {\n  public async getSessionList(queryParams?: QueryParams) {\n    return this.request<Session[]>({\n      method: 'GET',\n      path: basePath,\n      queryParams: queryParams,\n    });\n  }\n\n  public async getSession(sessionId: string) {\n    this.requireId(sessionId);\n    return this.request<Session>({\n      method: 'GET',\n      path: joinPaths(basePath, sessionId),\n    });\n  }\n\n  public async revokeSession(sessionId: string) {\n    this.requireId(sessionId);\n    return this.request<Session>({\n      method: 'POST',\n      path: joinPaths(basePath, sessionId, 'revoke'),\n    });\n  }\n\n  public async verifySession(sessionId: string, token: string) {\n    this.requireId(sessionId);\n    return this.request<Session>({\n      method: 'POST',\n      path: joinPaths(basePath, sessionId, 'verify'),\n      bodyParams: { token },\n    });\n  }\n\n  public async getToken(sessionId: string, template: string) {\n    this.requireId(sessionId);\n    return (\n      (await this.request<Token>({\n        method: 'POST',\n        path: joinPaths(basePath, sessionId, 'tokens', template || ''),\n      })) as any\n    ).jwt;\n  }\n}\n","import { joinPaths } from '../../util/path';\nimport type { SignInToken } from '../resources/SignInTokens';\nimport { AbstractAPI } from './AbstractApi';\n\ntype CreateSignInTokensParams = {\n  userId: string;\n  expiresInSeconds: number;\n};\n\nconst basePath = '/sign_in_tokens';\n\nexport class SignInTokenAPI extends AbstractAPI {\n  public async createSignInToken(params: CreateSignInTokensParams) {\n    return this.request<SignInToken>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async revokeSignInToken(signInTokenId: string) {\n    this.requireId(signInTokenId);\n    return this.request<SignInToken>({\n      method: 'POST',\n      path: joinPaths(basePath, signInTokenId, 'revoke'),\n    });\n  }\n}\n","import type { SMSMessage } from '../resources/SMSMessage';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/sms_messages';\n\ntype SMSParams = {\n  phoneNumberId: string;\n  message: string;\n};\n\nexport class SMSMessageAPI extends AbstractAPI {\n  public async createSMSMessage(params: SMSParams) {\n    return this.request<SMSMessage>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n}\n","import type { OAuthProvider } from '@clerk/types';\n\nimport { joinPaths } from '../../util/path';\nimport type { OauthAccessToken, OrganizationMembership, User } from '../resources';\nimport { AbstractAPI } from './AbstractApi';\n\nconst basePath = '/users';\n\ntype UserCountParams = {\n  emailAddress?: string[];\n  phoneNumber?: string[];\n  username?: string[];\n  web3Wallet?: string[];\n  query?: string;\n  userId?: string[];\n  externalId?: string[];\n};\n\ntype UserListParams = UserCountParams & {\n  limit?: number;\n  offset?: number;\n  orderBy?: 'created_at' | 'updated_at' | '+created_at' | '+updated_at' | '-created_at' | '-updated_at';\n};\n\ntype UserMetadataParams = {\n  publicMetadata?: UserPublicMetadata;\n  privateMetadata?: UserPrivateMetadata;\n  unsafeMetadata?: UserUnsafeMetadata;\n};\n\ntype PasswordHasher =\n  | 'argon2i'\n  | 'argon2id'\n  | 'bcrypt'\n  | 'md5'\n  | 'pbkdf2_sha256'\n  | 'pbkdf2_sha256_django'\n  | 'pbkdf2_sha1'\n  | 'scrypt_firebase';\n\ntype UserPasswordHashingParams = {\n  passwordDigest: string;\n  passwordHasher: PasswordHasher;\n};\n\ntype CreateUserParams = {\n  externalId?: string;\n  emailAddress?: string[];\n  phoneNumber?: string[];\n  username?: string;\n  password?: string;\n  firstName?: string;\n  lastName?: string;\n  skipPasswordChecks?: boolean;\n  skipPasswordRequirement?: boolean;\n  totpSecret?: string;\n  backupCodes?: string[];\n} & UserMetadataParams &\n  (UserPasswordHashingParams | {});\n\ninterface UpdateUserParams extends UserMetadataParams {\n  firstName?: string;\n  lastName?: string;\n  username?: string;\n  password?: string;\n  skipPasswordChecks?: boolean;\n  signOutOfOtherSessions?: boolean;\n  primaryEmailAddressID?: string;\n  primaryPhoneNumberID?: string;\n  primaryWeb3WalletID?: string;\n  profileImageID?: string;\n  totpSecret?: string;\n  backupCodes?: string[];\n  externalId?: string;\n  createdAt?: Date;\n}\n\ntype GetOrganizationMembershipListParams = {\n  userId: string;\n  limit?: number;\n  offset?: number;\n};\n\ntype VerifyPasswordParams = {\n  userId: string;\n  password: string;\n};\n\ntype VerifyTOTPParams = {\n  userId: string;\n  code: string;\n};\n\nexport class UserAPI extends AbstractAPI {\n  public async getUserList(params: UserListParams = {}) {\n    return this.request<User[]>({\n      method: 'GET',\n      path: basePath,\n      queryParams: params,\n    });\n  }\n\n  public async getUser(userId: string) {\n    this.requireId(userId);\n    return this.request<User>({\n      method: 'GET',\n      path: joinPaths(basePath, userId),\n    });\n  }\n\n  public async createUser(params: CreateUserParams) {\n    return this.request<User>({\n      method: 'POST',\n      path: basePath,\n      bodyParams: params,\n    });\n  }\n\n  public async updateUser(userId: string, params: UpdateUserParams = {}) {\n    this.requireId(userId);\n\n    return this.request<User>({\n      method: 'PATCH',\n      path: joinPaths(basePath, userId),\n      bodyParams: params,\n    });\n  }\n\n  public async updateUserMetadata(userId: string, params: UserMetadataParams) {\n    this.requireId(userId);\n\n    return this.request<User>({\n      method: 'PATCH',\n      path: joinPaths(basePath, userId, 'metadata'),\n      bodyParams: params,\n    });\n  }\n\n  public async deleteUser(userId: string) {\n    this.requireId(userId);\n    return this.request<User>({\n      method: 'DELETE',\n      path: joinPaths(basePath, userId),\n    });\n  }\n\n  public async getCount(params: UserListParams = {}) {\n    return this.request<number>({\n      method: 'GET',\n      path: joinPaths(basePath, 'count'),\n      queryParams: params,\n    });\n  }\n\n  public async getUserOauthAccessToken(userId: string, provider: `oauth_${OAuthProvider}`) {\n    this.requireId(userId);\n    return this.request<OauthAccessToken[]>({\n      method: 'GET',\n      path: joinPaths(basePath, userId, 'oauth_access_tokens', provider),\n    });\n  }\n\n  public async disableUserMFA(userId: string) {\n    this.requireId(userId);\n    return this.request<User>({\n      method: 'DELETE',\n      path: joinPaths(basePath, userId, 'mfa'),\n    });\n  }\n\n  public async getOrganizationMembershipList(params: GetOrganizationMembershipListParams) {\n    const { userId, limit, offset } = params;\n    this.requireId(userId);\n\n    return this.request<OrganizationMembership[]>({\n      method: 'GET',\n      path: joinPaths(basePath, userId, 'organization_memberships'),\n      queryParams: { limit, offset },\n    });\n  }\n\n  public async verifyPassword(params: VerifyPasswordParams) {\n    const { userId, password } = params;\n    this.requireId(userId);\n\n    return this.request<{ verified: true }>({\n      method: 'POST',\n      path: joinPaths(basePath, userId, 'verify_password'),\n      bodyParams: { password },\n    });\n  }\n\n  public async verifyTOTP(params: VerifyTOTPParams) {\n    const { userId, code } = params;\n    this.requireId(userId);\n\n    return this.request<{ verified: true; code_type: 'totp' }>({\n      method: 'POST',\n      path: joinPaths(basePath, userId, 'verify_totp'),\n      bodyParams: { code },\n    });\n  }\n}\n","import type { ClerkAPIError, ClerkAPIErrorJSON } from '@clerk/types';\nimport deepmerge from 'deepmerge';\nimport snakecaseKeys from 'snakecase-keys';\n\nimport { API_URL, API_VERSION, USER_AGENT } from '../constants';\n// DO NOT CHANGE: Runtime needs to be imported as a default export so that we can stub its dependencies with Sinon.js\n// For more information refer to https://sinonjs.org/how-to/stub-dependency/\nimport runtime from '../runtime';\nimport { assertValidSecretKey } from '../util/assertValidSecretKey';\nimport { joinPaths } from '../util/path';\nimport type { CreateBackendApiOptions } from './factory';\nimport { deserialize } from './resources/Deserializer';\n\nexport type ClerkBackendApiRequestOptions = {\n  method: 'GET' | 'POST' | 'PATCH' | 'DELETE' | 'PUT';\n  queryParams?: Record<string, unknown>;\n  headerParams?: Record<string, string>;\n  bodyParams?: object;\n} & (\n  | {\n      url: string;\n      path?: string;\n    }\n  | {\n      url?: string;\n      path: string;\n    }\n);\n\nexport type ClerkBackendApiResponse<T> =\n  | {\n      data: T;\n      errors: null;\n    }\n  | {\n      data: null;\n      errors: ClerkAPIError[];\n    };\n\nexport type RequestFunction = ReturnType<typeof buildRequest>;\ntype LegacyRequestFunction = <T>(requestOptions: ClerkBackendApiRequestOptions) => Promise<T>;\n\n/**\n * Switching to the { data, errors } format is a breaking change, so we will skip it for now\n * until we release v5 of the related SDKs.\n * This HOF wraps the request helper and transforms the new return to the legacy return.\n * TODO: Simply remove this wrapper and the ClerkAPIResponseError before the v5 release.\n */\nconst withLegacyReturn =\n  (cb: any): LegacyRequestFunction =>\n  async (...args) => {\n    // @ts-ignore\n    const { data, errors, status, statusText } = await cb<T>(...args);\n    if (errors === null) {\n      return data;\n    } else {\n      throw new ClerkAPIResponseError(statusText || '', {\n        data: errors,\n        status: status || '',\n      });\n    }\n  };\n\nexport function buildRequest(options: CreateBackendApiOptions) {\n  const request = async <T>(requestOptions: ClerkBackendApiRequestOptions): Promise<ClerkBackendApiResponse<T>> => {\n    const {\n      apiKey,\n      secretKey,\n      apiUrl = API_URL,\n      apiVersion = API_VERSION,\n      userAgent = USER_AGENT,\n      httpOptions = {},\n    } = options;\n    const { path, method, queryParams, headerParams, bodyParams } = requestOptions;\n    const key = secretKey || apiKey;\n\n    assertValidSecretKey(key);\n\n    const url = joinPaths(apiUrl, apiVersion, path);\n\n    // Build final URL with search parameters\n    const finalUrl = new URL(url);\n\n    if (queryParams) {\n      // Snakecase query parameters\n      const snakecasedQueryParams = snakecaseKeys({ ...queryParams });\n\n      // Support array values for queryParams such as { foo: [42, 43] }\n      for (const [key, val] of Object.entries(snakecasedQueryParams)) {\n        if (val) {\n          [val].flat().forEach(v => finalUrl.searchParams.append(key, v as string));\n        }\n      }\n    }\n\n    // Build headers\n    const headers = {\n      Authorization: `Bearer ${key}`,\n      'Content-Type': 'application/json',\n      'Clerk-Backend-SDK': userAgent,\n      ...headerParams,\n    };\n\n    // Build body\n    const hasBody = method !== 'GET' && bodyParams && Object.keys(bodyParams).length > 0;\n    const body = hasBody ? { body: JSON.stringify(snakecaseKeys(bodyParams, { deep: false })) } : null;\n\n    let res: Response | undefined = undefined;\n    try {\n      res = await runtime.fetch(\n        finalUrl.href,\n        deepmerge(httpOptions, {\n          method,\n          headers,\n          ...body,\n        }),\n      );\n\n      // TODO: Parse JSON or Text response based on a response header\n      const isJSONResponse = headers && headers['Content-Type'] === 'application/json';\n      const data = await (isJSONResponse ? res.json() : res.text());\n\n      if (!res.ok) {\n        throw data;\n      }\n\n      return {\n        data: deserialize(data),\n        errors: null,\n      };\n    } catch (err) {\n      if (err instanceof Error) {\n        return {\n          data: null,\n          errors: [\n            {\n              code: 'unexpected_error',\n              message: err.message || 'Unexpected error',\n            },\n          ],\n        };\n      }\n\n      return {\n        data: null,\n        errors: parseErrors(err),\n        // TODO: To be removed with withLegacyReturn\n        // @ts-expect-error\n        status: res?.status,\n        statusText: res?.statusText,\n      };\n    }\n  };\n\n  return withLegacyReturn(request);\n}\n\nfunction parseErrors(data: unknown): ClerkAPIError[] {\n  if (!!data && typeof data === 'object' && 'errors' in data) {\n    const errors = data.errors as ClerkAPIErrorJSON[];\n    return errors.length > 0 ? errors.map(parseError) : [];\n  }\n  return [];\n}\n\nfunction parseError(error: ClerkAPIErrorJSON): ClerkAPIError {\n  return {\n    code: error.code,\n    message: error.message,\n    longMessage: error.long_message,\n    meta: {\n      paramName: error?.meta?.param_name,\n      sessionId: error?.meta?.session_id,\n    },\n  };\n}\n\nclass ClerkAPIResponseError extends Error {\n  clerkError: true;\n\n  status: number;\n  message: string;\n\n  errors: ClerkAPIError[];\n\n  constructor(message: string, { data, status }: { data: ClerkAPIError[]; status: number }) {\n    super(message);\n\n    Object.setPrototypeOf(this, ClerkAPIResponseError.prototype);\n\n    this.clerkError = true;\n    this.message = message;\n    this.status = status;\n    this.errors = data;\n  }\n}\n","export const API_URL = 'https://api.clerk.dev';\nexport const API_VERSION = 'v1';\n\n// TODO: Get information from package.json or define them from ESBuild\nexport const USER_AGENT = `@clerk/backend`;\nexport const MAX_CACHE_LAST_UPDATED_AT_SECONDS = 5 * 60;\n\nconst Attributes = {\n  AuthStatus: '__clerkAuthStatus',\n  AuthReason: '__clerkAuthReason',\n  AuthMessage: '__clerkAuthMessage',\n} as const;\n\nconst Cookies = {\n  Session: '__session',\n  ClientUat: '__client_uat',\n} as const;\n\nconst Headers = {\n  AuthStatus: 'x-clerk-auth-status',\n  AuthReason: 'x-clerk-auth-reason',\n  AuthMessage: 'x-clerk-auth-message',\n  EnableDebug: 'x-clerk-debug',\n  ClerkRedirectTo: 'x-clerk-redirect-to',\n  Authorization: 'authorization',\n  ForwardedPort: 'x-forwarded-port',\n  ForwardedProto: 'x-forwarded-proto',\n  ForwardedHost: 'x-forwarded-host',\n  Referrer: 'referer',\n  UserAgent: 'user-agent',\n  Origin: 'origin',\n  Host: 'host',\n  ContentType: 'content-type',\n} as const;\n\nconst SearchParams = {\n  AuthStatus: Headers.AuthStatus,\n} as const;\n\nconst ContentTypes = {\n  Json: 'application/json',\n} as const;\n\nexport const constants = {\n  Attributes,\n  Cookies,\n  Headers,\n  SearchParams,\n  ContentTypes,\n} as const;\n","/**\n * This file exports APIs that vary across runtimes (i.e. Node & Browser - V8 isolates)\n * as a singleton object.\n *\n * Runtime polyfills are written in VanillaJS for now to avoid TS complication. Moreover,\n * due to this issue https://github.com/microsoft/TypeScript/issues/44848, there is not a good way\n * to tell Typescript which conditional import to use during build type.\n *\n * The Runtime type definition ensures type safety for now.\n * Runtime js modules are copied into dist folder with bash script.\n *\n * TODO: Support TS runtime modules\n */\n\n// @ts-expect-error\nimport crypto from '#crypto';\n// @ts-expect-error\nimport fetch from '#fetch';\n\ntype Runtime = {\n  crypto: Crypto;\n  fetch: typeof global.fetch;\n};\n\n// Invoking the global.fetch without binding it first to the globalObject fails in\n// Cloudflare Workers with an \"Illegal Invocation\" error.\n//\n// The globalThis object is supported for Node >= 12.0.\n//\n// https://github.com/supabase/supabase/issues/4417\nconst globalFetch = fetch.bind(globalThis);\n\n// DO NOT CHANGE: Runtime needs to be imported as a default export so that we can stub its dependencies with Sinon.js\n// For more information refer to https://sinonjs.org/how-to/stub-dependency/\nconst runtime: Runtime = { crypto, fetch: globalFetch };\nexport default runtime;\n","export function assertValidSecretKey(val: unknown): asserts val is string {\n  if (!val || typeof val !== 'string') {\n    throw Error(\n      'Missing Clerk Secret Key or API Key. Go to https://dashboard.clerk.com and get your key for your instance.',\n    );\n  }\n\n  //TODO: Check if the key is invalid and throw error\n}\n","import type { AllowlistIdentifierJSON } from './JSON';\n\nexport class AllowlistIdentifier {\n  constructor(\n    readonly id: string,\n    readonly identifier: string,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly invitationId?: string,\n  ) {}\n\n  static fromJSON(data: AllowlistIdentifierJSON): AllowlistIdentifier {\n    return new AllowlistIdentifier(data.id, data.identifier, data.created_at, data.updated_at, data.invitation_id);\n  }\n}\n","import type { SessionJSON } from './JSON';\n\nexport class Session {\n  constructor(\n    readonly id: string,\n    readonly clientId: string,\n    readonly userId: string,\n    readonly status: string,\n    readonly lastActiveAt: number,\n    readonly expireAt: number,\n    readonly abandonAt: number,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n  ) {}\n\n  static fromJSON(data: SessionJSON): Session {\n    return new Session(\n      data.id,\n      data.client_id,\n      data.user_id,\n      data.status,\n      data.last_active_at,\n      data.expire_at,\n      data.abandon_at,\n      data.created_at,\n      data.updated_at,\n    );\n  }\n}\n","import type { ClientJSON } from './JSON';\nimport { Session } from './Session';\n\nexport class Client {\n  constructor(\n    readonly id: string,\n    readonly sessionIds: string[],\n    readonly sessions: Session[],\n    readonly signInId: string | null,\n    readonly signUpId: string | null,\n    readonly lastActiveSessionId: string | null,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n  ) {}\n\n  static fromJSON(data: ClientJSON): Client {\n    return new Client(\n      data.id,\n      data.session_ids,\n      data.sessions.map(x => Session.fromJSON(x)),\n      data.sign_in_id,\n      data.sign_up_id,\n      data.last_active_session_id,\n      data.created_at,\n      data.updated_at,\n    );\n  }\n}\n","import type { DeletedObjectJSON } from './JSON';\n\nexport class DeletedObject {\n  constructor(\n    readonly object: string,\n    readonly id: string | null,\n    readonly slug: string | null,\n    readonly deleted: boolean,\n  ) {}\n\n  static fromJSON(data: DeletedObjectJSON) {\n    return new DeletedObject(data.object, data.id || null, data.slug || null, data.deleted);\n  }\n}\n","import type { EmailJSON } from './JSON';\n\nexport class Email {\n  constructor(\n    readonly id: string,\n    readonly fromEmailName: string,\n    readonly emailAddressId: string | null,\n    readonly toEmailAddress?: string,\n    readonly subject?: string,\n    readonly body?: string,\n    readonly bodyPlain?: string | null,\n    readonly status?: string,\n    readonly slug?: string | null,\n    readonly data?: Record<string, any> | null,\n    readonly deliveredByClerk?: boolean,\n  ) {}\n\n  static fromJSON(data: EmailJSON): Email {\n    return new Email(\n      data.id,\n      data.from_email_name,\n      data.email_address_id,\n      data.to_email_address,\n      data.subject,\n      data.body,\n      data.body_plain,\n      data.status,\n      data.slug,\n      data.data,\n      data.delivered_by_clerk,\n    );\n  }\n}\n","import type { IdentificationLinkJSON } from './JSON';\n\nexport class IdentificationLink {\n  constructor(readonly id: string, readonly type: string) {}\n\n  static fromJSON(data: IdentificationLinkJSON): IdentificationLink {\n    return new IdentificationLink(data.id, data.type);\n  }\n}\n","import type { VerificationJSON } from './JSON';\n\nexport class Verification {\n  constructor(\n    readonly status: string,\n    readonly strategy: string,\n    readonly externalVerificationRedirectURL: URL | null = null,\n    readonly attempts: number | null = null,\n    readonly expireAt: number | null = null,\n    readonly nonce: string | null = null,\n  ) {}\n\n  static fromJSON(data: VerificationJSON): Verification {\n    return new Verification(\n      data.status,\n      data.strategy,\n      data.external_verification_redirect_url ? new URL(data.external_verification_redirect_url) : null,\n      data.attempts,\n      data.expire_at,\n      data.nonce,\n    );\n  }\n}\n","import { IdentificationLink } from './IdentificationLink';\nimport type { EmailAddressJSON } from './JSON';\nimport { Verification } from './Verification';\n\nexport class EmailAddress {\n  constructor(\n    readonly id: string,\n    readonly emailAddress: string,\n    readonly verification: Verification | null,\n    readonly linkedTo: IdentificationLink[],\n  ) {}\n\n  static fromJSON(data: EmailAddressJSON): EmailAddress {\n    return new EmailAddress(\n      data.id,\n      data.email_address,\n      data.verification && Verification.fromJSON(data.verification),\n      data.linked_to.map(link => IdentificationLink.fromJSON(link)),\n    );\n  }\n}\n","import type { ExternalAccountJSON } from './JSON';\nimport { Verification } from './Verification';\n\nexport class ExternalAccount {\n  constructor(\n    readonly id: string,\n    readonly provider: string,\n    readonly identificationId: string,\n    readonly externalId: string,\n    readonly approvedScopes: string,\n    readonly emailAddress: string,\n    readonly firstName: string,\n    readonly lastName: string,\n    readonly picture: string,\n    readonly imageUrl: string,\n    readonly username: string | null,\n    readonly publicMetadata: Record<string, unknown> | null = {},\n    readonly label: string | null,\n    readonly verification: Verification | null,\n  ) {}\n\n  static fromJSON(data: ExternalAccountJSON): ExternalAccount {\n    return new ExternalAccount(\n      data.id,\n      data.provider,\n      data.identification_id,\n      data.provider_user_id,\n      data.approved_scopes,\n      data.email_address,\n      data.first_name,\n      data.last_name,\n      data.avatar_url,\n      data.image_url,\n      data.username,\n      data.public_metadata,\n      data.label,\n      data.verification && Verification.fromJSON(data.verification),\n    );\n  }\n}\n","import type { InvitationStatus } from './Enums';\nimport type { InvitationJSON } from './JSON';\n\nexport class Invitation {\n  constructor(\n    readonly id: string,\n    readonly emailAddress: string,\n    readonly publicMetadata: Record<string, unknown> | null,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly status: InvitationStatus,\n    readonly revoked?: boolean,\n  ) {}\n\n  static fromJSON(data: InvitationJSON): Invitation {\n    return new Invitation(\n      data.id,\n      data.email_address,\n      data.public_metadata,\n      data.created_at,\n      data.updated_at,\n      data.status,\n      data.revoked,\n    );\n  }\n}\n","import type {\n  InvitationStatus,\n  OrganizationInvitationStatus,\n  OrganizationMembershipRole,\n  SignInStatus,\n  SignUpAttributeRequirements,\n  SignUpStatus,\n} from './Enums';\n\nexport enum ObjectType {\n  AllowlistIdentifier = 'allowlist_identifier',\n  Client = 'client',\n  Email = 'email',\n  EmailAddress = 'email_address',\n  ExternalAccount = 'external_account',\n  FacebookAccount = 'facebook_account',\n  GoogleAccount = 'google_account',\n  Invitation = 'invitation',\n  OauthAccessToken = 'oauth_access_token',\n  Organization = 'organization',\n  OrganizationInvitation = 'organization_invitation',\n  OrganizationMembership = 'organization_membership',\n  PhoneNumber = 'phone_number',\n  RedirectUrl = 'redirect_url',\n  Session = 'session',\n  SignInAttempt = 'sign_in_attempt',\n  SignInToken = 'sign_in_token',\n  SignUpAttempt = 'sign_up_attempt',\n  SmsMessage = 'sms_message',\n  User = 'user',\n  Web3Wallet = 'web3_wallet',\n  Token = 'token',\n  TotalCount = 'total_count',\n}\n\nexport interface ClerkResourceJSON {\n  object: ObjectType;\n  id: string;\n}\n\nexport interface TokenJSON {\n  object: ObjectType.Token;\n  jwt: string;\n}\n\nexport interface AllowlistIdentifierJSON extends ClerkResourceJSON {\n  object: ObjectType.AllowlistIdentifier;\n  identifier: string;\n  created_at: number;\n  updated_at: number;\n  invitation_id?: string;\n}\n\nexport interface ClientJSON extends ClerkResourceJSON {\n  object: ObjectType.Client;\n  session_ids: string[];\n  sessions: SessionJSON[];\n  sign_in_id: string | null;\n  sign_up_id: string | null;\n  last_active_session_id: string | null;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface EmailJSON extends ClerkResourceJSON {\n  object: ObjectType.Email;\n  from_email_name: string;\n  to_email_address?: string;\n  email_address_id: string | null;\n  subject?: string;\n  body?: string;\n  body_plain?: string | null;\n  status?: string;\n  slug?: string | null;\n  data?: Record<string, any> | null;\n  delivered_by_clerk?: boolean;\n}\n\nexport interface EmailAddressJSON extends ClerkResourceJSON {\n  object: ObjectType.EmailAddress;\n  email_address: string;\n  verification: VerificationJSON | null;\n  linked_to: IdentificationLinkJSON[];\n}\n\nexport interface ExternalAccountJSON extends ClerkResourceJSON {\n  object: ObjectType.ExternalAccount;\n  provider: string;\n  identification_id: string;\n  provider_user_id: string;\n  approved_scopes: string;\n  email_address: string;\n  first_name: string;\n  last_name: string;\n  avatar_url: string;\n  /**\n   * @experimental\n   */\n  image_url: string;\n  username: string | null;\n  public_metadata: Record<string, unknown> | null;\n  label: string | null;\n  verification: VerificationJSON | null;\n}\n\nexport interface IdentificationLinkJSON extends ClerkResourceJSON {\n  type: string;\n}\n\nexport interface InvitationJSON extends ClerkResourceJSON {\n  object: ObjectType.Invitation;\n  email_address: string;\n  public_metadata: Record<string, unknown> | null;\n  created_at: number;\n  updated_at: number;\n  status: InvitationStatus;\n  revoked?: boolean;\n}\n\nexport interface OauthAccessTokenJSON {\n  object: ObjectType.OauthAccessToken;\n  provider: string;\n  token: string;\n  public_metadata: Record<string, unknown>;\n  label: string;\n  // Only set in OAuth 2.0 tokens\n  scopes?: string[];\n  // Only set in OAuth 1.0 tokens\n  token_secret?: string;\n}\n\nexport interface OrganizationJSON extends ClerkResourceJSON {\n  object: ObjectType.Organization;\n  name: string;\n  slug: string | null;\n  logo_url: string | null;\n  /**\n   * @experimental\n   */\n  image_url: string;\n  public_metadata: OrganizationPublicMetadata | null;\n  private_metadata?: OrganizationPrivateMetadata;\n  created_by: string;\n  created_at: number;\n  updated_at: number;\n  max_allowed_memberships: number;\n}\n\nexport interface OrganizationInvitationJSON extends ClerkResourceJSON {\n  email_address: string;\n  organization_id: string;\n  public_metadata: OrganizationInvitationPublicMetadata;\n  role: OrganizationMembershipRole;\n  status: OrganizationInvitationStatus;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface OrganizationMembershipJSON extends ClerkResourceJSON {\n  object: ObjectType.OrganizationMembership;\n  organization: OrganizationJSON;\n  public_metadata: OrganizationMembershipPublicMetadata;\n  private_metadata?: OrganizationMembershipPrivateMetadata;\n  public_user_data: OrganizationMembershipPublicUserDataJSON;\n  role: OrganizationMembershipRole;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface OrganizationMembershipPublicUserDataJSON {\n  identifier: string;\n  first_name: string | null;\n  last_name: string | null;\n  profile_image_url: string;\n  /**\n   * @experimental\n   */\n  image_url: string;\n  user_id: string;\n}\n\nexport interface PhoneNumberJSON extends ClerkResourceJSON {\n  object: ObjectType.PhoneNumber;\n  phone_number: string;\n  reserved_for_second_factor: boolean;\n  default_second_factor: boolean;\n  linked_to: IdentificationLinkJSON[];\n  verification: VerificationJSON | null;\n}\n\nexport interface RedirectUrlJSON extends ClerkResourceJSON {\n  object: ObjectType.RedirectUrl;\n  url: string;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface SessionJSON extends ClerkResourceJSON {\n  object: ObjectType.Session;\n  client_id: string;\n  user_id: string;\n  status: string;\n  last_active_at: number;\n  expire_at: number;\n  abandon_at: number;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface SignInJSON extends ClerkResourceJSON {\n  object: ObjectType.SignInToken;\n  status: SignInStatus;\n  identifier: string;\n  created_session_id: string | null;\n}\n\nexport interface SignInTokenJSON extends ClerkResourceJSON {\n  user_id: string;\n  token: string;\n  status: 'pending' | 'accepted' | 'revoked';\n  url: string;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface SignUpJSON extends ClerkResourceJSON {\n  object: ObjectType.SignUpAttempt;\n  status: SignUpStatus;\n  attribute_requirements: SignUpAttributeRequirements;\n  username: string | null;\n  email_address: string | null;\n  phone_number: string | null;\n  web3_wallet: string | null;\n  web3_wallet_verification: VerificationJSON | null;\n  external_account: any;\n  has_password: boolean;\n  name_full: string | null;\n  created_session_id: string | null;\n  created_user_id: string | null;\n  abandon_at: number | null;\n}\n\nexport interface SMSMessageJSON extends ClerkResourceJSON {\n  object: ObjectType.SmsMessage;\n  from_phone_number: string;\n  to_phone_number: string;\n  phone_number_id: string | null;\n  message: string;\n  status: string;\n  data?: Record<string, any> | null;\n}\n\nexport interface UserJSON extends ClerkResourceJSON {\n  object: ObjectType.User;\n  username: string | null;\n  first_name: string;\n  last_name: string;\n  gender: string;\n  birthday: string;\n  profile_image_url: string;\n  /**\n   * @experimental\n   */\n  image_url: string;\n  primary_email_address_id: string;\n  primary_phone_number_id: string | null;\n  primary_web3_wallet_id: string | null;\n  password_enabled: boolean;\n  totp_enabled: boolean;\n  backup_code_enabled: boolean;\n  two_factor_enabled: boolean;\n  banned: boolean;\n  email_addresses: EmailAddressJSON[];\n  phone_numbers: PhoneNumberJSON[];\n  web3_wallets: Web3WalletJSON[];\n  external_accounts: ExternalAccountJSON[];\n  external_id: string | null;\n  last_sign_in_at: number | null;\n  public_metadata: UserPublicMetadata;\n  private_metadata: UserPrivateMetadata;\n  unsafe_metadata: UserUnsafeMetadata;\n  created_at: number;\n  updated_at: number;\n}\n\nexport interface VerificationJSON extends ClerkResourceJSON {\n  attempts?: number | null;\n  expire_at: number | null;\n  external_verification_redirect_url?: string;\n  nonce?: string | null;\n  status: string;\n  strategy: string;\n  verified_at_client?: string;\n  // error?\n}\n\nexport interface Web3WalletJSON extends ClerkResourceJSON {\n  object: ObjectType.Web3Wallet;\n  web3_wallet: string;\n  verification: VerificationJSON | null;\n}\n\nexport interface DeletedObjectJSON {\n  object: string;\n  id?: string;\n  slug?: string;\n  deleted: boolean;\n}\n","import type { OauthAccessTokenJSON } from './JSON';\n\nexport class OauthAccessToken {\n  constructor(\n    readonly provider: string,\n    readonly token: string,\n    readonly publicMetadata: Record<string, unknown> = {},\n    readonly label: string,\n    readonly scopes?: string[],\n    readonly tokenSecret?: string,\n  ) {}\n\n  static fromJSON(data: OauthAccessTokenJSON) {\n    return new OauthAccessToken(\n      data.provider,\n      data.token,\n      data.public_metadata,\n      data.label,\n      data.scopes,\n      data.token_secret,\n    );\n  }\n}\n","import type { OrganizationJSON } from './JSON';\n\nexport class Organization {\n  constructor(\n    readonly id: string,\n    readonly name: string,\n    readonly slug: string | null,\n    readonly logoUrl: string | null,\n    readonly imageUrl: string,\n    readonly createdBy: string,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly publicMetadata: OrganizationPublicMetadata | null = {},\n    readonly privateMetadata: OrganizationPrivateMetadata = {},\n    readonly maxAllowedMemberships: number,\n  ) {}\n\n  static fromJSON(data: OrganizationJSON): Organization {\n    return new Organization(\n      data.id,\n      data.name,\n      data.slug,\n      data.logo_url,\n      data.image_url,\n      data.created_by,\n      data.created_at,\n      data.updated_at,\n      data.public_metadata,\n      data.private_metadata,\n      data.max_allowed_memberships,\n    );\n  }\n}\n","import type { OrganizationInvitationStatus, OrganizationMembershipRole } from './Enums';\nimport type { OrganizationInvitationJSON } from './JSON';\n\nexport class OrganizationInvitation {\n  constructor(\n    readonly id: string,\n    readonly emailAddress: string,\n    readonly role: OrganizationMembershipRole,\n    readonly organizationId: string,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly status?: OrganizationInvitationStatus,\n    readonly publicMetadata: OrganizationInvitationPublicMetadata = {},\n  ) {}\n\n  static fromJSON(data: OrganizationInvitationJSON) {\n    return new OrganizationInvitation(\n      data.id,\n      data.email_address,\n      data.role,\n      data.organization_id,\n      data.created_at,\n      data.updated_at,\n      data.status,\n      data.public_metadata,\n    );\n  }\n}\n","import { Organization } from '../resources';\nimport type { OrganizationMembershipRole } from './Enums';\nimport type { OrganizationMembershipJSON, OrganizationMembershipPublicUserDataJSON } from './JSON';\n\nexport class OrganizationMembership {\n  constructor(\n    readonly id: string,\n    readonly role: OrganizationMembershipRole,\n    readonly publicMetadata: OrganizationMembershipPublicMetadata = {},\n    readonly privateMetadata: OrganizationMembershipPrivateMetadata = {},\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly organization: Organization,\n    readonly publicUserData?: OrganizationMembershipPublicUserData | null,\n  ) {}\n\n  static fromJSON(data: OrganizationMembershipJSON) {\n    return new OrganizationMembership(\n      data.id,\n      data.role,\n      data.public_metadata,\n      data.private_metadata,\n      data.created_at,\n      data.updated_at,\n      Organization.fromJSON(data.organization),\n      OrganizationMembershipPublicUserData.fromJSON(data.public_user_data),\n    );\n  }\n}\n\nexport class OrganizationMembershipPublicUserData {\n  constructor(\n    readonly identifier: string,\n    readonly firstName: string | null,\n    readonly lastName: string | null,\n    readonly profileImageUrl: string,\n    readonly imageUrl: string,\n    readonly userId: string,\n  ) {}\n\n  static fromJSON(data: OrganizationMembershipPublicUserDataJSON) {\n    return new OrganizationMembershipPublicUserData(\n      data.identifier,\n      data.first_name,\n      data.last_name,\n      data.profile_image_url,\n      data.image_url,\n      data.user_id,\n    );\n  }\n}\n","import { IdentificationLink } from './IdentificationLink';\nimport type { PhoneNumberJSON } from './JSON';\nimport { Verification } from './Verification';\n\nexport class PhoneNumber {\n  constructor(\n    readonly id: string,\n    readonly phoneNumber: string,\n    readonly reservedForSecondFactor: boolean,\n    readonly defaultSecondFactor: boolean,\n    readonly verification: Verification | null,\n    readonly linkedTo: IdentificationLink[],\n  ) {}\n\n  static fromJSON(data: PhoneNumberJSON): PhoneNumber {\n    return new PhoneNumber(\n      data.id,\n      data.phone_number,\n      data.reserved_for_second_factor,\n      data.default_second_factor,\n      data.verification && Verification.fromJSON(data.verification),\n      data.linked_to.map(link => IdentificationLink.fromJSON(link)),\n    );\n  }\n}\n","import type { RedirectUrlJSON } from './JSON';\n\nexport class RedirectUrl {\n  constructor(readonly id: string, readonly url: string, readonly createdAt: number, readonly updatedAt: number) {}\n\n  static fromJSON(data: RedirectUrlJSON): RedirectUrl {\n    return new RedirectUrl(data.id, data.url, data.created_at, data.updated_at);\n  }\n}\n","import type { SignInTokenJSON } from './JSON';\n\nexport class SignInToken {\n  constructor(\n    readonly id: string,\n    readonly userId: string,\n    readonly token: string,\n    readonly status: string,\n    readonly url: string,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n  ) {}\n\n  static fromJSON(data: SignInTokenJSON): SignInToken {\n    return new SignInToken(data.id, data.user_id, data.token, data.status, data.url, data.created_at, data.updated_at);\n  }\n}\n","import type { SMSMessageJSON } from './JSON';\n\nexport class SMSMessage {\n  constructor(\n    readonly id: string,\n    readonly fromPhoneNumber: string,\n    readonly toPhoneNumber: string,\n    readonly message: string,\n    readonly status: string,\n    readonly phoneNumberId: string | null,\n    readonly data?: Record<string, any> | null,\n  ) {}\n\n  static fromJSON(data: SMSMessageJSON): SMSMessage {\n    return new SMSMessage(\n      data.id,\n      data.from_phone_number,\n      data.to_phone_number,\n      data.message,\n      data.status,\n      data.phone_number_id,\n      data.data,\n    );\n  }\n}\n","import type { TokenJSON } from './JSON';\n\nexport class Token {\n  constructor(readonly jwt: string) {}\n\n  static fromJSON(data: TokenJSON): Token {\n    return new Token(data.jwt);\n  }\n}\n","import type { Web3WalletJSON } from './JSON';\nimport { Verification } from './Verification';\n\nexport class Web3Wallet {\n  constructor(readonly id: string, readonly web3Wallet: string, readonly verification: Verification | null) {}\n\n  static fromJSON(data: Web3WalletJSON): Web3Wallet {\n    return new Web3Wallet(data.id, data.web3_wallet, data.verification && Verification.fromJSON(data.verification));\n  }\n}\n","import { EmailAddress } from './EmailAddress';\nimport { ExternalAccount } from './ExternalAccount';\nimport type { ExternalAccountJSON, UserJSON } from './JSON';\nimport { PhoneNumber } from './PhoneNumber';\nimport { Web3Wallet } from './Web3Wallet';\n\nexport class User {\n  constructor(\n    readonly id: string,\n    readonly passwordEnabled: boolean,\n    readonly totpEnabled: boolean,\n    readonly backupCodeEnabled: boolean,\n    readonly twoFactorEnabled: boolean,\n    readonly banned: boolean,\n    readonly createdAt: number,\n    readonly updatedAt: number,\n    readonly profileImageUrl: string,\n    readonly imageUrl: string,\n    readonly gender: string,\n    readonly birthday: string,\n    readonly primaryEmailAddressId: string | null,\n    readonly primaryPhoneNumberId: string | null,\n    readonly primaryWeb3WalletId: string | null,\n    readonly lastSignInAt: number | null,\n    readonly externalId: string | null,\n    readonly username: string | null,\n    readonly firstName: string | null,\n    readonly lastName: string | null,\n    readonly publicMetadata: UserPublicMetadata = {},\n    readonly privateMetadata: UserPrivateMetadata = {},\n    readonly unsafeMetadata: UserUnsafeMetadata = {},\n    readonly emailAddresses: EmailAddress[] = [],\n    readonly phoneNumbers: PhoneNumber[] = [],\n    readonly web3Wallets: Web3Wallet[] = [],\n    readonly externalAccounts: ExternalAccount[] = [],\n  ) {}\n\n  static fromJSON(data: UserJSON): User {\n    return new User(\n      data.id,\n      data.password_enabled,\n      data.totp_enabled,\n      data.backup_code_enabled,\n      data.two_factor_enabled,\n      data.banned,\n      data.created_at,\n      data.updated_at,\n      data.profile_image_url,\n      data.image_url,\n      data.gender,\n      data.birthday,\n      data.primary_email_address_id,\n      data.primary_phone_number_id,\n      data.primary_web3_wallet_id,\n      data.last_sign_in_at,\n      data.external_id,\n      data.username,\n      data.first_name,\n      data.last_name,\n      data.public_metadata,\n      data.private_metadata,\n      data.unsafe_metadata,\n      (data.email_addresses || []).map(x => EmailAddress.fromJSON(x)),\n      (data.phone_numbers || []).map(x => PhoneNumber.fromJSON(x)),\n      (data.web3_wallets || []).map(x => Web3Wallet.fromJSON(x)),\n      (data.external_accounts || []).map((x: ExternalAccountJSON) => ExternalAccount.fromJSON(x)),\n    );\n  }\n}\n","import {\n  AllowlistIdentifier,\n  Client,\n  DeletedObject,\n  Email,\n  EmailAddress,\n  Invitation,\n  OauthAccessToken,\n  Organization,\n  OrganizationInvitation,\n  OrganizationMembership,\n  PhoneNumber,\n  RedirectUrl,\n  Session,\n  SignInToken,\n  SMSMessage,\n  Token,\n  User,\n} from '.';\nimport { ObjectType } from './JSON';\n\n// FIXME don't return any\nexport function deserialize(payload: any): any {\n  if (Array.isArray(payload)) {\n    return payload.map(item => jsonToObject(item));\n  } else if (isPaginated(payload)) {\n    return payload.data.map(item => jsonToObject(item));\n  } else {\n    return jsonToObject(payload);\n  }\n}\n\ntype PaginatedResponse = {\n  data: object[];\n};\n\nfunction isPaginated(payload: any): payload is PaginatedResponse {\n  return Array.isArray(payload.data) && <PaginatedResponse>payload.data !== undefined;\n}\n\nfunction getCount(item: { total_count: number }) {\n  return item.total_count;\n}\n\n// TODO: Revise response deserialization\nfunction jsonToObject(item: any): any {\n  // Special case: DeletedObject\n  // TODO: Improve this check\n  if (typeof item !== 'string' && 'object' in item && 'deleted' in item) {\n    return DeletedObject.fromJSON(item);\n  }\n\n  switch (item.object) {\n    case ObjectType.AllowlistIdentifier:\n      return AllowlistIdentifier.fromJSON(item);\n    case ObjectType.Client:\n      return Client.fromJSON(item);\n    case ObjectType.EmailAddress:\n      return EmailAddress.fromJSON(item);\n    case ObjectType.Email:\n      return Email.fromJSON(item);\n    case ObjectType.Invitation:\n      return Invitation.fromJSON(item);\n    case ObjectType.OauthAccessToken:\n      return OauthAccessToken.fromJSON(item);\n    case ObjectType.Organization:\n      return Organization.fromJSON(item);\n    case ObjectType.OrganizationInvitation:\n      return OrganizationInvitation.fromJSON(item);\n    case ObjectType.OrganizationMembership:\n      return OrganizationMembership.fromJSON(item);\n    case ObjectType.PhoneNumber:\n      return PhoneNumber.fromJSON(item);\n    case ObjectType.RedirectUrl:\n      return RedirectUrl.fromJSON(item);\n    case ObjectType.SignInToken:\n      return SignInToken.fromJSON(item);\n    case ObjectType.Session:\n      return Session.fromJSON(item);\n    case ObjectType.SmsMessage:\n      return SMSMessage.fromJSON(item);\n    case ObjectType.Token:\n      return Token.fromJSON(item);\n    case ObjectType.TotalCount:\n      return getCount(item);\n    case ObjectType.User:\n      return User.fromJSON(item);\n    default:\n      return item;\n  }\n}\n","import {\n  AllowlistIdentifierAPI,\n  ClientAPI,\n  DomainAPI,\n  EmailAddressAPI,\n  EmailAPI,\n  InterstitialAPI,\n  InvitationAPI,\n  OrganizationAPI,\n  PhoneNumberAPI,\n  RedirectUrlAPI,\n  SessionAPI,\n  SignInTokenAPI,\n  SMSMessageAPI,\n  UserAPI,\n} from './endpoints';\nimport { buildRequest } from './request';\n\nexport type CreateBackendApiOptions = {\n  /**\n   * Backend API key\n   * @deprecated Use `secretKey` instead.\n   */\n  apiKey?: string;\n  /* Secret Key */\n  secretKey?: string;\n  /* Backend API URL */\n  apiUrl?: string;\n  /* Backend API version */\n  apiVersion?: string;\n  /* Library/SDK name */\n  userAgent?: string;\n  /**\n   * @deprecated This option has been deprecated and will be removed with the next major release.\n   * A RequestInit init object used by the `request` method.\n   */\n  httpOptions?: RequestInit;\n};\n\nexport type ApiClient = ReturnType<typeof createBackendApiClient>;\n\nexport function createBackendApiClient(options: CreateBackendApiOptions) {\n  const request = buildRequest(options);\n\n  return {\n    allowlistIdentifiers: new AllowlistIdentifierAPI(request),\n    clients: new ClientAPI(request),\n    emailAddresses: new EmailAddressAPI(request),\n    emails: new EmailAPI(request),\n    interstitial: new InterstitialAPI(request),\n    invitations: new InvitationAPI(request),\n    organizations: new OrganizationAPI(request),\n    phoneNumbers: new PhoneNumberAPI(request),\n    redirectUrls: new RedirectUrlAPI(request),\n    sessions: new SessionAPI(request),\n    signInTokens: new SignInTokenAPI(request),\n    smsMessages: new SMSMessageAPI(request),\n    users: new UserAPI(request),\n    domains: new DomainAPI(request),\n  };\n}\n","import type { ActClaim, JwtPayload, ServerGetToken, ServerGetTokenOptions } from '@clerk/types';\n\nimport type { Organization, Session, User } from '../api';\nimport { createBackendApiClient } from '../api';\nimport type { RequestState } from './authStatus';\nimport type { AuthenticateRequestOptions } from './request';\n\ntype AuthObjectDebugData = Partial<AuthenticateRequestOptions & RequestState>;\ntype CreateAuthObjectDebug = (data?: AuthObjectDebugData) => AuthObjectDebug;\ntype AuthObjectDebug = () => unknown;\n\nexport type SignedInAuthObjectOptions = {\n  /**\n   * @deprecated Use `secretKey` instead.\n   */\n  apiKey?: string;\n  secretKey?: string;\n  apiUrl: string;\n  apiVersion: string;\n  token: string;\n  session?: Session;\n  user?: User;\n  organization?: Organization;\n};\n\nexport type SignedInAuthObject = {\n  sessionClaims: JwtPayload;\n  sessionId: string;\n  session: Session | undefined;\n  actor: ActClaim | undefined;\n  userId: string;\n  user: User | undefined;\n  orgId: string | undefined;\n  orgRole: string | undefined;\n  orgSlug: string | undefined;\n  organization: Organization | undefined;\n  getToken: ServerGetToken;\n  debug: AuthObjectDebug;\n};\n\nexport type SignedOutAuthObject = {\n  sessionClaims: null;\n  sessionId: null;\n  session: null;\n  actor: null;\n  userId: null;\n  user: null;\n  orgId: null;\n  orgRole: null;\n  orgSlug: null;\n  organization: null;\n  getToken: ServerGetToken;\n  debug: AuthObjectDebug;\n};\n\nexport type AuthObject = SignedInAuthObject | SignedOutAuthObject;\n\nconst createDebug: CreateAuthObjectDebug = data => {\n  return () => {\n    const res = { ...data } || {};\n    res.apiKey = (res.apiKey || '').substring(0, 7);\n    res.secretKey = (res.secretKey || '').substring(0, 7);\n    res.jwtKey = (res.jwtKey || '').substring(0, 7);\n    return { ...res };\n  };\n};\n\nexport function signedInAuthObject(\n  sessionClaims: JwtPayload,\n  options: SignedInAuthObjectOptions,\n  debugData?: AuthObjectDebugData,\n): SignedInAuthObject {\n  const {\n    act: actor,\n    sid: sessionId,\n    org_id: orgId,\n    org_role: orgRole,\n    org_slug: orgSlug,\n    sub: userId,\n  } = sessionClaims;\n  const { apiKey, secretKey, apiUrl, apiVersion, token, session, user, organization } = options;\n\n  const { sessions } = createBackendApiClient({\n    apiKey,\n    secretKey,\n    apiUrl,\n    apiVersion,\n  });\n\n  const getToken = createGetToken({\n    sessionId,\n    sessionToken: token,\n    fetcher: (...args) => sessions.getToken(...args),\n  });\n\n  return {\n    actor,\n    sessionClaims,\n    sessionId,\n    session,\n    userId,\n    user,\n    orgId,\n    orgRole,\n    orgSlug,\n    organization,\n    getToken,\n    debug: createDebug({ ...options, ...debugData }),\n  };\n}\n\nexport function signedOutAuthObject(debugData?: AuthObjectDebugData): SignedOutAuthObject {\n  return {\n    sessionClaims: null,\n    sessionId: null,\n    session: null,\n    userId: null,\n    user: null,\n    actor: null,\n    orgId: null,\n    orgRole: null,\n    orgSlug: null,\n    organization: null,\n    getToken: () => Promise.resolve(null),\n    debug: createDebug(debugData),\n  };\n}\n\nexport function prunePrivateMetadata(resource?: { private_metadata: any } | { privateMetadata: any } | null) {\n  // Delete sensitive private metadata from resource before rendering in SSR\n  if (resource) {\n    // @ts-ignore\n    delete resource['privateMetadata'];\n    // @ts-ignore\n    delete resource['private_metadata'];\n  }\n\n  return resource;\n}\n\nexport function sanitizeAuthObject<T extends Record<any, any>>(authObject: T): T {\n  const user = authObject.user ? { ...authObject.user } : authObject.user;\n  const organization = authObject.organization ? { ...authObject.organization } : authObject.organization;\n\n  prunePrivateMetadata(user);\n  prunePrivateMetadata(organization);\n\n  return { ...authObject, user, organization };\n}\n\n/**\n * Auth objects moving through the server -> client boundary need to be serializable\n * as we need to ensure that they can be transferred via the network as pure strings.\n * Some frameworks like Remix or Next (/pages dir only) handle this serialization by simply\n * ignoring any non-serializable keys, however Nextjs /app directory is stricter and\n * throws an error if a non-serializable value is found.\n */\nexport const makeAuthObjectSerializable = <T extends Record<string, unknown>>(obj: T): T => {\n  // remove any non-serializable props from the returned object\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { debug, getToken, ...rest } = obj as unknown as AuthObject;\n  return rest as unknown as T;\n};\n\ntype TokenFetcher = (sessionId: string, template: string) => Promise<string>;\n\ntype CreateGetToken = (params: { sessionId: string; sessionToken: string; fetcher: TokenFetcher }) => ServerGetToken;\n\nconst createGetToken: CreateGetToken = params => {\n  const { fetcher, sessionToken, sessionId } = params || {};\n\n  return async (options: ServerGetTokenOptions = {}) => {\n    if (!sessionId) {\n      return null;\n    }\n\n    if (options.template) {\n      return fetcher(sessionId, options.template);\n    }\n\n    return sessionToken;\n  };\n};\n","function wait(ms: number) {\n  return new Promise(res => setTimeout(res, ms));\n}\n\nconst MAX_NUMBER_OF_RETRIES = 5;\n\n// TODO: Move this to @clerk/shared and reuse it with @clerk/clerk-js\nexport async function callWithRetry<T>(\n  fn: (...args: unknown[]) => Promise<T>,\n  attempt = 1,\n  maxAttempts = MAX_NUMBER_OF_RETRIES,\n): Promise<T> {\n  try {\n    return await fn();\n  } catch (e) {\n    if (attempt >= maxAttempts) {\n      throw e;\n    }\n    await wait(2 ** attempt * 100);\n\n    return callWithRetry(fn, attempt + 1);\n  }\n}\n","export function isDevelopmentFromApiKey(apiKey: string): boolean {\n  return apiKey.startsWith('test_') || apiKey.startsWith('sk_test_');\n}\n\nexport function isProductionFromApiKey(apiKey: string): boolean {\n  return apiKey.startsWith('live_') || apiKey.startsWith('sk_live_');\n}\n\nexport function isStaging(frontendApi: string): boolean {\n  return (\n    frontendApi.endsWith('.lclstage.dev') ||\n    frontendApi.endsWith('.stgstage.dev') ||\n    frontendApi.endsWith('.clerkstage.dev') ||\n    frontendApi.endsWith('.accountsstage.dev')\n  );\n}\n","// TODO: use the same function from @clerk/shared once treeshakable\nfunction createDevOrStagingUrlCache() {\n  const DEV_OR_STAGING_SUFFIXES = [\n    '.lcl.dev',\n    '.stg.dev',\n    '.lclstage.dev',\n    '.stgstage.dev',\n    '.dev.lclclerk.com',\n    '.stg.lclclerk.com',\n    '.accounts.lclclerk.com',\n    'accountsstage.dev',\n    'accounts.dev',\n  ];\n\n  const devOrStagingUrlCache = new Map<string, boolean>();\n\n  return {\n    isDevOrStagingUrl: (url: string | URL): boolean => {\n      if (!url) {\n        return false;\n      }\n\n      const hostname = typeof url === 'string' ? url : url.hostname;\n      let res = devOrStagingUrlCache.get(hostname);\n      if (res === undefined) {\n        res = DEV_OR_STAGING_SUFFIXES.some(s => hostname.endsWith(s));\n        devOrStagingUrlCache.set(hostname, res);\n      }\n      return res;\n    },\n  };\n}\nconst { isDevOrStagingUrl } = createDevOrStagingUrlCache();\nexport { isDevOrStagingUrl };\n","import type { PublishableKey } from '@clerk/types';\n\nconst PUBLISHABLE_KEY_LIVE_PREFIX = 'pk_live_';\nconst PUBLISHABLE_KEY_TEST_PREFIX = 'pk_test_';\n\n// This regex matches the publishable like frontend API keys (e.g. foo-bar-13.clerk.accounts.dev)\nconst PUBLISHABLE_FRONTEND_API_DEV_REGEX = /^(([a-z]+)-){2}([0-9]{1,2})\\.clerk\\.accounts([a-z.]*)(dev|com)$/i;\n\nexport function buildPublishableKey(frontendApi: string): string {\n  const keyPrefix = PUBLISHABLE_FRONTEND_API_DEV_REGEX.test(frontendApi)\n    ? PUBLISHABLE_KEY_TEST_PREFIX\n    : PUBLISHABLE_KEY_LIVE_PREFIX;\n  return `${keyPrefix}${btoa(`${frontendApi}$`)}`;\n}\n\nexport function parsePublishableKey(key: string | undefined): PublishableKey | null {\n  key = key || '';\n\n  if (!isPublishableKey(key)) {\n    return null;\n  }\n\n  const instanceType = key.startsWith(PUBLISHABLE_KEY_LIVE_PREFIX) ? 'production' : 'development';\n\n  let frontendApi = isomorphicAtob(key.split('_')[2]);\n\n  if (!frontendApi.endsWith('$')) {\n    return null;\n  }\n\n  frontendApi = frontendApi.slice(0, -1);\n\n  return {\n    instanceType,\n    frontendApi,\n  };\n}\n\nexport function isPublishableKey(key: string) {\n  key = key || '';\n\n  const hasValidPrefix = key.startsWith(PUBLISHABLE_KEY_LIVE_PREFIX) || key.startsWith(PUBLISHABLE_KEY_TEST_PREFIX);\n\n  const hasValidFrontendApiPostfix = isomorphicAtob(key.split('_')[2] || '').endsWith('$');\n\n  return hasValidPrefix && hasValidFrontendApiPostfix;\n}\n\nconst isomorphicAtob = (data: string) => {\n  if (typeof atob !== 'undefined' && typeof atob === 'function') {\n    return atob(data);\n  } else if (typeof globalThis !== 'undefined' && globalThis.Buffer) {\n    return new globalThis.Buffer(data, 'base64').toString();\n  }\n  return data;\n};\n","export type TokenCarrier = 'header' | 'cookie';\n\nexport enum TokenVerificationErrorCode {\n  InvalidSecretKey = 'clerk_key_invalid',\n}\n\nexport enum TokenVerificationErrorReason {\n  TokenExpired = 'token-expired',\n  TokenInvalid = 'token-invalid',\n  TokenInvalidAlgorithm = 'token-invalid-algorithm',\n  TokenInvalidAuthorizedParties = 'token-invalid-authorized-parties',\n  TokenInvalidIssuer = 'token-invalid-issuer',\n  TokenInvalidSignature = 'token-invalid-signature',\n  TokenNotActiveYet = 'token-not-active-yet',\n  TokenVerificationFailed = 'token-verification-failed',\n  InvalidSecretKey = 'secret-key-invalid',\n\n  LocalJWKMissing = 'jwk-local-missing',\n\n  RemoteJWKFailedToLoad = 'jwk-remote-failed-to-load',\n  RemoteJWKInvalid = 'jwk-remote-invalid',\n  RemoteJWKMissing = 'jwk-remote-missing',\n\n  JWKFailedToResolve = 'jwk-failed-to-resolve',\n\n  RemoteInterstitialFailedToLoad = 'interstitial-remote-failed-to-load',\n}\n\nexport enum TokenVerificationErrorAction {\n  ContactSupport = 'Contact support@clerk.com',\n  EnsureClerkJWT = 'Make sure that this is a valid Clerk generate JWT.',\n  SetClerkJWTKey = 'Set the CLERK_JWT_KEY environment variable.',\n  SetClerkSecretKeyOrAPIKey = 'Set the CLERK_SECRET_KEY or CLERK_API_KEY environment variable.',\n}\n\nexport class TokenVerificationError extends Error {\n  action?: TokenVerificationErrorAction;\n  reason: TokenVerificationErrorReason;\n  tokenCarrier?: TokenCarrier;\n\n  constructor({\n    action,\n    message,\n    reason,\n  }: {\n    action?: TokenVerificationErrorAction;\n    message: string;\n    reason: TokenVerificationErrorReason;\n  }) {\n    super(message);\n\n    Object.setPrototypeOf(this, TokenVerificationError.prototype);\n\n    this.reason = reason;\n    this.message = message;\n    this.action = action;\n  }\n\n  public getFullMessage() {\n    return `${[this.message, this.action].filter(m => m).join(' ')} (reason=${this.reason}, token-carrier=${\n      this.tokenCarrier\n    })`;\n  }\n}\n","import type { MultiDomainAndOrProxyPrimitives } from '@clerk/types';\n\nimport { API_VERSION } from '../constants';\n// DO NOT CHANGE: Runtime needs to be imported as a default export so that we can stub its dependencies with Sinon.js\n// For more information refer to https://sinonjs.org/how-to/stub-dependency/\nimport runtime from '../runtime';\nimport { callWithRetry } from '../util/callWithRetry';\nimport { isStaging } from '../util/instance';\nimport { isDevOrStagingUrl } from '../util/isDevOrStagingUrl';\nimport { parsePublishableKey } from '../util/parsePublishableKey';\nimport { joinPaths } from '../util/path';\nimport { TokenVerificationError, TokenVerificationErrorAction, TokenVerificationErrorReason } from './errors';\nimport type { DebugRequestSate } from './request';\n\nexport type LoadInterstitialOptions = {\n  apiUrl: string;\n  frontendApi: string;\n  publishableKey: string;\n  clerkJSUrl?: string;\n  clerkJSVersion?: string;\n  /**\n   * @deprecated\n   */\n  pkgVersion?: string;\n  debugData?: DebugRequestSate;\n  isSatellite?: boolean;\n  signInUrl?: string;\n} & MultiDomainAndOrProxyPrimitives;\n\n// TODO: use the same function from @clerk/shared once treeshakable\nexport function addClerkPrefix(str: string | undefined) {\n  if (!str) {\n    return '';\n  }\n  let regex;\n  if (str.match(/^(clerk\\.)+\\w*$/)) {\n    regex = /(clerk\\.)*(?=clerk\\.)/;\n  } else if (str.match(/\\.clerk.accounts/)) {\n    return str;\n  } else {\n    regex = /^(clerk\\.)*/gi;\n  }\n\n  const stripped = str.replace(regex, '');\n  return `clerk.${stripped}`;\n}\n\nexport function loadInterstitialFromLocal(options: Omit<LoadInterstitialOptions, 'apiUrl'>) {\n  options.frontendApi = parsePublishableKey(options.publishableKey)?.frontendApi || options.frontendApi || '';\n  const domainOnlyInProd = !isDevOrStagingUrl(options.frontendApi) ? addClerkPrefix(options.domain) : '';\n  const {\n    debugData,\n    frontendApi,\n    pkgVersion,\n    clerkJSUrl,\n    clerkJSVersion,\n    publishableKey,\n    proxyUrl,\n    isSatellite = false,\n    domain,\n    signInUrl,\n  } = options;\n  return `\n    <head>\n        <meta charset=\"UTF-8\" />\n    </head>\n    <body>\n        <script>\n            window.__clerk_frontend_api = '${frontendApi}';\n            window.__clerk_debug = ${JSON.stringify(debugData || {})};\n            ${proxyUrl ? `window.__clerk_proxy_url = '${proxyUrl}'` : ''}\n            ${domain ? `window.__clerk_domain = '${domain}'` : ''}\n            window.startClerk = async () => {\n                function formRedirect(){\n                    const form = '<form method=\"get\" action=\"\" name=\"redirect\"></form>';\n                    document.body.innerHTML = document.body.innerHTML + form;\n\n                    const searchParams = new URLSearchParams(window.location.search);\n                    for (let paramTuple of searchParams) {\n                        const input = document.createElement(\"input\");\n                        input.type = \"hidden\";\n                        input.name = paramTuple[0];\n                        input.value = paramTuple[1];\n                        document.forms.redirect.appendChild(input);\n                    }\n                    const url = new URL(window.location.origin + window.location.pathname + window.location.hash);\n                    window.history.pushState({}, '', url);\n\n                    document.forms.redirect.action = window.location.pathname + window.location.hash;\n                    document.forms.redirect.submit();\n                }\n\n                const Clerk = window.Clerk;\n                try {\n                    await Clerk.load({\n                        isSatellite: ${isSatellite},\n                        isInterstitial: ${true},\n                        signInUrl: ${signInUrl ? `'${signInUrl}'` : undefined}\n                    });\n                    if(Clerk.loaded){\n                      if(window.location.href.indexOf(\"#\") === -1){\n                        window.location.href = window.location.href;\n                      } else if (window.navigator.userAgent.toLowerCase().includes(\"firefox/\")){\n                          formRedirect();\n                      } else {\n                          window.location.reload();\n                      }\n                    }\n                } catch (err) {\n                    console.error('Clerk: ', err);\n                }\n            };\n            (() => {\n                const script = document.createElement('script');\n                ${\n                  publishableKey\n                    ? `script.setAttribute('data-clerk-publishable-key', '${publishableKey}');`\n                    : `script.setAttribute('data-clerk-frontend-api', '${frontendApi}');`\n                }\n\n                ${domain ? `script.setAttribute('data-clerk-domain', '${domain}');` : ''}\n                ${proxyUrl ? `script.setAttribute('data-clerk-proxy-url', '${proxyUrl}')` : ''};\n                script.async = true;\n                script.src = '${\n                  clerkJSUrl ||\n                  getScriptUrl(proxyUrl || domainOnlyInProd || frontendApi, {\n                    pkgVersion,\n                    clerkJSVersion,\n                  })\n                }';\n                script.crossOrigin = 'anonymous';\n                script.addEventListener('load', startClerk);\n                document.body.appendChild(script);\n            })();\n        </script>\n    </body>\n`;\n}\n\n// TODO: Add caching to Interstitial\nexport async function loadInterstitialFromBAPI(options: LoadInterstitialOptions) {\n  options.frontendApi = parsePublishableKey(options.publishableKey)?.frontendApi || options.frontendApi || '';\n  const url = buildPublicInterstitialUrl(options);\n  const response = await callWithRetry(() => runtime.fetch(buildPublicInterstitialUrl(options)));\n\n  if (!response.ok) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.ContactSupport,\n      message: `Error loading Clerk Interstitial from ${url} with code=${response.status}`,\n      reason: TokenVerificationErrorReason.RemoteInterstitialFailedToLoad,\n    });\n  }\n\n  return response.text();\n}\n\nexport function buildPublicInterstitialUrl(options: LoadInterstitialOptions) {\n  options.frontendApi = parsePublishableKey(options.publishableKey)?.frontendApi || options.frontendApi || '';\n  const { apiUrl, frontendApi, pkgVersion, clerkJSVersion, publishableKey, proxyUrl, isSatellite, domain, signInUrl } =\n    options;\n  const url = new URL(apiUrl);\n  url.pathname = joinPaths(url.pathname, API_VERSION, '/public/interstitial');\n  url.searchParams.append('clerk_js_version', clerkJSVersion || getClerkJsMajorVersionOrTag(frontendApi, pkgVersion));\n  if (publishableKey) {\n    url.searchParams.append('publishable_key', publishableKey);\n  } else {\n    url.searchParams.append('frontend_api', frontendApi);\n  }\n  if (proxyUrl) {\n    url.searchParams.append('proxy_url', proxyUrl);\n  }\n\n  if (isSatellite) {\n    url.searchParams.append('is_satellite', 'true');\n  }\n\n  url.searchParams.append('sign_in_url', signInUrl || '');\n\n  if (!isDevOrStagingUrl(options.frontendApi)) {\n    url.searchParams.append('use_domain_for_script', 'true');\n  }\n\n  if (domain) {\n    url.searchParams.append('domain', domain);\n  }\n\n  return url.href;\n}\n\n// TODO: Move to @clerk/shared as the same logic is used in @clerk/react\nconst getClerkJsMajorVersionOrTag = (frontendApi: string, pkgVersion?: string) => {\n  if (!pkgVersion && isStaging(frontendApi)) {\n    return 'staging';\n  }\n\n  if (!pkgVersion) {\n    return 'latest';\n  }\n\n  if (pkgVersion.includes('next')) {\n    return 'next';\n  }\n\n  return pkgVersion.split('.')[0] || 'latest';\n};\n\nconst getScriptUrl = (\n  frontendApi: string,\n  { pkgVersion, clerkJSVersion }: { pkgVersion?: string; clerkJSVersion?: string },\n) => {\n  const noSchemeFrontendApi = frontendApi.replace(/http(s)?:\\/\\//, '');\n  const major = getClerkJsMajorVersionOrTag(frontendApi, pkgVersion);\n  return `https://${noSchemeFrontendApi}/npm/@clerk/clerk-js@${clerkJSVersion || major}/dist/clerk.browser.js`;\n};\n","import type { JwtPayload } from '@clerk/types';\n\nimport { createBackendApiClient } from '../api';\nimport type { SignedInAuthObject, SignedOutAuthObject } from './authObjects';\nimport { signedInAuthObject, signedOutAuthObject } from './authObjects';\nimport type { TokenVerificationErrorReason } from './errors';\n\nexport enum AuthStatus {\n  SignedIn = 'signed-in',\n  SignedOut = 'signed-out',\n  Interstitial = 'interstitial',\n  Unknown = 'unknown',\n}\n\nexport type SignedInState = {\n  status: AuthStatus.SignedIn;\n  reason: null;\n  message: null;\n  frontendApi: string;\n  proxyUrl?: string;\n  publishableKey: string;\n  isSatellite: boolean;\n  domain: string;\n  signInUrl: string;\n  isSignedIn: true;\n  isInterstitial: false;\n  isUnknown: false;\n  toAuth: () => SignedInAuthObject;\n};\n\nexport type SignedOutState = {\n  status: AuthStatus.SignedOut;\n  message: string;\n  reason: AuthReason;\n  frontendApi: string;\n  proxyUrl?: string;\n  publishableKey: string;\n  isSatellite: boolean;\n  domain: string;\n  signInUrl: string;\n  isSignedIn: false;\n  isInterstitial: false;\n  isUnknown: false;\n  toAuth: () => SignedOutAuthObject;\n};\n\nexport type InterstitialState = Omit<SignedOutState, 'isInterstitial' | 'status' | 'toAuth'> & {\n  status: AuthStatus.Interstitial;\n  isInterstitial: true;\n  toAuth: () => null;\n};\n\nexport type UnknownState = Omit<InterstitialState, 'status' | 'isInterstitial' | 'isUnknown'> & {\n  status: AuthStatus.Unknown;\n  isInterstitial: false;\n  isUnknown: true;\n};\n\nexport enum AuthErrorReason {\n  CookieAndUATMissing = 'cookie-and-uat-missing',\n  CookieMissing = 'cookie-missing',\n  CookieOutDated = 'cookie-outdated',\n  CookieUATMissing = 'uat-missing',\n  CrossOriginReferrer = 'cross-origin-referrer',\n  HeaderMissingCORS = 'header-missing-cors',\n  HeaderMissingNonBrowser = 'header-missing-non-browser',\n  SatelliteCookieNeedsSyncing = 'satellite-needs-syncing',\n  SatelliteReturnsFromPrimary = 'satellite-returns-from-primary',\n  PrimaryRespondsToSyncing = 'primary-responds-to-syncing',\n  StandardSignedIn = 'standard-signed-in',\n  StandardSignedOut = 'standard-signed-out',\n  UnexpectedError = 'unexpected-error',\n  Unknown = 'unknown',\n}\n\nexport type AuthReason = AuthErrorReason | TokenVerificationErrorReason;\n\nexport type RequestState = SignedInState | SignedOutState | InterstitialState | UnknownState;\n\nexport async function signedIn<T>(options: T, sessionClaims: JwtPayload): Promise<SignedInState> {\n  const {\n    apiKey,\n    secretKey,\n    apiUrl,\n    apiVersion,\n    cookieToken,\n    frontendApi,\n    proxyUrl,\n    publishableKey,\n    domain,\n    isSatellite,\n    headerToken,\n    loadSession,\n    loadUser,\n    loadOrganization,\n    signInUrl,\n  } = options as any;\n\n  const { sid: sessionId, org_id: orgId, sub: userId } = sessionClaims;\n\n  const { sessions, users, organizations } = createBackendApiClient({\n    apiKey,\n    secretKey,\n    apiUrl,\n    apiVersion,\n  });\n\n  const [sessionResp, userResp, organizationResp] = await Promise.all([\n    loadSession ? sessions.getSession(sessionId) : Promise.resolve(undefined),\n    loadUser ? users.getUser(userId) : Promise.resolve(undefined),\n    loadOrganization && orgId ? organizations.getOrganization({ organizationId: orgId }) : Promise.resolve(undefined),\n  ]);\n\n  const session = sessionResp;\n  const user = userResp;\n  const organization = organizationResp;\n  // const session = sessionResp && !sessionResp.errors ? sessionResp.data : undefined;\n  // const user = userResp && !userResp.errors ? userResp.data : undefined;\n  // const organization = organizationResp && !organizationResp.errors ? organizationResp.data : undefined;\n\n  const authObject = signedInAuthObject(\n    sessionClaims,\n    {\n      secretKey,\n      apiKey,\n      apiUrl,\n      apiVersion,\n      token: cookieToken || headerToken || '',\n      session,\n      user,\n      organization,\n    },\n    { ...options, status: AuthStatus.SignedIn },\n  );\n\n  return {\n    status: AuthStatus.SignedIn,\n    reason: null,\n    message: null,\n    frontendApi,\n    proxyUrl,\n    publishableKey,\n    domain,\n    isSatellite,\n    signInUrl,\n    isSignedIn: true,\n    isInterstitial: false,\n    isUnknown: false,\n    toAuth: () => authObject,\n  };\n}\n\nexport function signedOut<T>(options: T, reason: AuthReason, message = ''): SignedOutState {\n  const { frontendApi, publishableKey, proxyUrl, isSatellite, domain, signInUrl } = options as any;\n\n  return {\n    status: AuthStatus.SignedOut,\n    reason,\n    message,\n    frontendApi,\n    proxyUrl,\n    publishableKey,\n    isSatellite,\n    domain,\n    signInUrl,\n    isSignedIn: false,\n    isInterstitial: false,\n    isUnknown: false,\n    toAuth: () => signedOutAuthObject({ ...options, status: AuthStatus.SignedOut, reason, message }),\n  };\n}\n\nexport function interstitial<T>(options: T, reason: AuthReason, message = ''): InterstitialState {\n  const { frontendApi, publishableKey, proxyUrl, isSatellite, domain, signInUrl } = options as any;\n  return {\n    status: AuthStatus.Interstitial,\n    reason,\n    message,\n    frontendApi,\n    publishableKey,\n    isSatellite,\n    domain,\n    proxyUrl,\n    signInUrl,\n    isSignedIn: false,\n    isInterstitial: true,\n    isUnknown: false,\n    toAuth: () => null,\n  };\n}\n\nexport function unknownState<T>(options: T, reason: AuthReason, message = ''): UnknownState {\n  const { frontendApi, publishableKey, isSatellite, domain, signInUrl } = options as any;\n  return {\n    status: AuthStatus.Unknown,\n    reason,\n    message,\n    frontendApi,\n    publishableKey,\n    isSatellite,\n    domain,\n    signInUrl,\n    isSignedIn: false,\n    isInterstitial: false,\n    isUnknown: true,\n    toAuth: () => null,\n  };\n}\n","/**\n * This function is only used in the case where:\n * - DevOrStaging key is present\n * - The request carries referrer information\n * (This case most of the times signifies redirect from Clerk Auth pages)\n *\n */\nexport function checkCrossOrigin({\n  originURL,\n  host,\n  forwardedHost,\n  forwardedPort,\n  forwardedProto,\n}: {\n  originURL: URL;\n  host?: string | null;\n  forwardedHost?: string | null;\n  forwardedPort?: string | null;\n  forwardedProto?: string | null;\n}) {\n  const fwdProto = getFirstValueFromHeaderValue(forwardedProto);\n  let fwdPort = getFirstValueFromHeaderValue(forwardedPort);\n\n  // If forwardedPort mismatch with forwardedProto determine forwardedPort\n  // from forwardedProto as fallback (if exists)\n  // This check fixes the Railway App issue\n  const fwdProtoHasMoreValuesThanFwdPorts =\n    (forwardedProto || '').split(',').length > (forwardedPort || '').split(',').length;\n  if (fwdProto && fwdProtoHasMoreValuesThanFwdPorts) {\n    fwdPort = getPortFromProtocol(fwdProto);\n  }\n\n  const originProtocol = getProtocolVerb(originURL.protocol);\n  if (fwdProto && fwdProto !== originProtocol) {\n    return true;\n  }\n\n  const protocol = fwdProto || originProtocol;\n  /* The forwarded host prioritised over host to be checked against the referrer.  */\n  const finalURL = convertHostHeaderValueToURL(forwardedHost || host || undefined, protocol);\n  finalURL.port = fwdPort || finalURL.port;\n\n  if (getPort(finalURL) !== getPort(originURL)) {\n    return true;\n  }\n  if (finalURL.hostname !== originURL.hostname) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function convertHostHeaderValueToURL(host?: string, protocol = 'https'): URL {\n  /**\n   * The protocol is added for the URL constructor to work properly.\n   * We do not check for the protocol at any point later on.\n   */\n  return new URL(`${protocol}://${host}`);\n}\n\nconst PROTOCOL_TO_PORT_MAPPING: Record<string, string> = {\n  http: '80',\n  https: '443',\n} as const;\n\nfunction getPort(url: URL) {\n  return url.port || getPortFromProtocol(url.protocol);\n}\n\nfunction getPortFromProtocol(protocol: string) {\n  return PROTOCOL_TO_PORT_MAPPING[protocol];\n}\n\nfunction getFirstValueFromHeaderValue(value?: string | null) {\n  return value?.split(',')[0]?.trim() || '';\n}\n\nfunction getProtocolVerb(protocol: string) {\n  return protocol?.replace(/:$/, '') || '';\n}\n\ntype ErrorFields = {\n  message: string;\n  long_message: string;\n  code: string;\n};\n\nexport const getErrorObjectByCode = (errors: ErrorFields[], code: string) => {\n  if (!errors) {\n    return null;\n  }\n\n  return errors.find((err: ErrorFields) => err.code === code);\n};\n","/**\n * The base64url helper was extracted from the rfc4648 package\n * in order to resolve CSJ/ESM interoperability issues\n *\n * https://github.com/swansontec/rfc4648.js\n *\n * For more context please refer to:\n * - https://github.com/evanw/esbuild/issues/1719\n * - https://github.com/evanw/esbuild/issues/532\n * - https://github.com/swansontec/rollup-plugin-mjs-entry\n */\nexport const base64url = {\n  parse(string: string, opts?: ParseOptions): Uint8Array {\n    return parse(string, base64UrlEncoding, opts);\n  },\n\n  stringify(data: ArrayLike<number>, opts?: StringifyOptions): string {\n    return stringify(data, base64UrlEncoding, opts);\n  },\n};\n\nconst base64UrlEncoding: Encoding = {\n  chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_',\n  bits: 6,\n};\n\ninterface Encoding {\n  bits: number;\n  chars: string;\n  codes?: { [char: string]: number };\n}\n\ninterface ParseOptions {\n  loose?: boolean;\n  out?: new (size: number) => { [index: number]: number };\n}\n\ninterface StringifyOptions {\n  pad?: boolean;\n}\n\nfunction parse(string: string, encoding: Encoding, opts: ParseOptions = {}): Uint8Array {\n  // Build the character lookup table:\n  if (!encoding.codes) {\n    encoding.codes = {};\n    for (let i = 0; i < encoding.chars.length; ++i) {\n      encoding.codes[encoding.chars[i]] = i;\n    }\n  }\n\n  // The string must have a whole number of bytes:\n  if (!opts.loose && (string.length * encoding.bits) & 7) {\n    throw new SyntaxError('Invalid padding');\n  }\n\n  // Count the padding bytes:\n  let end = string.length;\n  while (string[end - 1] === '=') {\n    --end;\n\n    // If we get a whole number of bytes, there is too much padding:\n    if (!opts.loose && !(((string.length - end) * encoding.bits) & 7)) {\n      throw new SyntaxError('Invalid padding');\n    }\n  }\n\n  // Allocate the output:\n  const out = new (opts.out ?? Uint8Array)(((end * encoding.bits) / 8) | 0) as Uint8Array;\n\n  // Parse the data:\n  let bits = 0; // Number of bits currently in the buffer\n  let buffer = 0; // Bits waiting to be written out, MSB first\n  let written = 0; // Next byte to write\n  for (let i = 0; i < end; ++i) {\n    // Read one character from the string:\n    const value = encoding.codes[string[i]];\n    if (value === undefined) {\n      throw new SyntaxError('Invalid character ' + string[i]);\n    }\n\n    // Append the bits to the buffer:\n    buffer = (buffer << encoding.bits) | value;\n    bits += encoding.bits;\n\n    // Write out some bits if the buffer has a byte's worth:\n    if (bits >= 8) {\n      bits -= 8;\n      out[written++] = 0xff & (buffer >> bits);\n    }\n  }\n\n  // Verify that we have received just enough bits:\n  if (bits >= encoding.bits || 0xff & (buffer << (8 - bits))) {\n    throw new SyntaxError('Unexpected end of data');\n  }\n\n  return out;\n}\n\nfunction stringify(data: ArrayLike<number>, encoding: Encoding, opts: StringifyOptions = {}): string {\n  const { pad = true } = opts;\n  const mask = (1 << encoding.bits) - 1;\n  let out = '';\n\n  let bits = 0; // Number of bits currently in the buffer\n  let buffer = 0; // Bits waiting to be written out, MSB first\n  for (let i = 0; i < data.length; ++i) {\n    // Slurp data into the buffer:\n    buffer = (buffer << 8) | (0xff & data[i]);\n    bits += 8;\n\n    // Write out as much as we can:\n    while (bits > encoding.bits) {\n      bits -= encoding.bits;\n      out += encoding.chars[mask & (buffer >> bits)];\n    }\n  }\n\n  // Partial character:\n  if (bits) {\n    out += encoding.chars[mask & (buffer << (encoding.bits - bits))];\n  }\n\n  // Add padding characters until we hit a byte boundary:\n  if (pad) {\n    while ((out.length * encoding.bits) & 7) {\n      out += '=';\n    }\n  }\n\n  return out;\n}\n","import { TokenVerificationError, TokenVerificationErrorAction, TokenVerificationErrorReason } from '../errors';\n\nconst isArrayString = (s: unknown): s is string[] => {\n  return Array.isArray(s) && s.length > 0 && s.every(a => typeof a === 'string');\n};\n\nexport const assertAudienceClaim = (aud?: unknown, audience?: unknown) => {\n  const audienceList = [audience].flat().filter(a => !!a);\n  const audList = [aud].flat().filter(a => !!a);\n  const shouldVerifyAudience = audienceList.length > 0 && audList.length > 0;\n\n  if (!shouldVerifyAudience) {\n    // Notice: Clerk JWTs use AZP claim instead of Audience\n    //\n    // return {\n    //   valid: false,\n    //   reason: `Invalid JWT audience claim (aud) ${JSON.stringify(\n    //     aud,\n    //   )}. Expected a string or a non-empty array of strings.`,\n    // };\n    return;\n  }\n\n  if (typeof aud === 'string') {\n    if (!audienceList.includes(aud)) {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.EnsureClerkJWT,\n        reason: TokenVerificationErrorReason.TokenVerificationFailed,\n        message: `Invalid JWT audience claim (aud) ${JSON.stringify(aud)}. Is not included in \"${JSON.stringify(\n          audienceList,\n        )}\".`,\n      });\n    }\n  } else if (isArrayString(aud)) {\n    if (!aud.some(a => audienceList.includes(a))) {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.EnsureClerkJWT,\n        reason: TokenVerificationErrorReason.TokenVerificationFailed,\n        message: `Invalid JWT audience claim array (aud) ${JSON.stringify(aud)}. Is not included in \"${JSON.stringify(\n          audienceList,\n        )}\".`,\n      });\n    }\n  }\n};\n","import type { Jwt, JwtPayload } from '@clerk/types';\n\n// DO NOT CHANGE: Runtime needs to be imported as a default export so that we can stub its dependencies with Sinon.js\n// For more information refer to https://sinonjs.org/how-to/stub-dependency/\nimport runtime from '../../runtime';\nimport { base64url } from '../../util/rfc4648';\nimport { TokenVerificationError, TokenVerificationErrorAction, TokenVerificationErrorReason } from '../errors';\nimport { assertAudienceClaim } from './assertions';\n\ntype IssuerResolver = string | ((iss: string) => boolean);\n\nconst DEFAULT_CLOCK_SKEW_IN_SECONDS = 5 * 1000;\n\nconst algToHash: Record<string, string> = {\n  RS256: 'SHA-256',\n  RS384: 'SHA-384',\n  RS512: 'SHA-512',\n  ES256: 'SHA-256',\n  ES384: 'SHA-384',\n  ES512: 'SHA-512',\n};\n\nconst RSA_ALGORITHM_NAME = 'RSASSA-PKCS1-v1_5';\nconst EC_ALGORITHM_NAME = 'ECDSA';\n\nconst jwksAlgToCryptoAlg: Record<string, string> = {\n  RS256: RSA_ALGORITHM_NAME,\n  RS384: RSA_ALGORITHM_NAME,\n  RS512: RSA_ALGORITHM_NAME,\n  ES256: EC_ALGORITHM_NAME,\n  ES384: EC_ALGORITHM_NAME,\n  ES512: EC_ALGORITHM_NAME,\n};\n\nconst algs = Object.keys(algToHash);\n\nexport async function hasValidSignature(jwt: Jwt, jwk: JsonWebKey) {\n  const { header, signature, raw } = jwt;\n  const encoder = new TextEncoder();\n  const data = encoder.encode([raw.header, raw.payload].join('.'));\n\n  const cryptoKey = await runtime.crypto.subtle.importKey(\n    'jwk',\n    jwk,\n    {\n      name: jwksAlgToCryptoAlg[header.alg],\n      hash: algToHash[header.alg],\n    },\n    false,\n    ['verify'],\n  );\n\n  return runtime.crypto.subtle.verify('RSASSA-PKCS1-v1_5', cryptoKey, signature, data);\n}\n\nexport function decodeJwt(token: string): Jwt {\n  const tokenParts = (token || '').toString().split('.');\n  if (tokenParts.length !== 3) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenInvalid,\n      message: `Invalid JWT form. A JWT consists of three parts separated by dots.`,\n    });\n  }\n\n  const [rawHeader, rawPayload, rawSignature] = tokenParts;\n\n  const decoder = new TextDecoder();\n\n  // To verify a JWS with SubtleCrypto you need to be careful to encode and decode\n  // the data properly between binary and base64url representation. Unfortunately\n  // the standard implementation in the V8 of btoa() and atob() are difficult to\n  // work with as they use \"a Unicode string containing only characters in the\n  // range U+0000 to U+00FF, each representing a binary byte with values 0x00 to\n  // 0xFF respectively\" as the representation of binary data.\n\n  // A better solution to represent binary data in Javascript is to use ES6 TypedArray\n  // and use a Javascript library to convert them to base64url that honors RFC 4648.\n\n  // Side note: The difference between base64 and base64url is the characters selected\n  // for value 62 and 63 in the standard, base64 encode them to + and / while base64url\n  // encode - and _.\n\n  // More info at https://stackoverflow.com/questions/54062583/how-to-verify-a-signed-jwt-with-subtlecrypto-of-the-web-crypto-API\n  const header = JSON.parse(decoder.decode(base64url.parse(rawHeader, { loose: true })));\n  const payload = JSON.parse(decoder.decode(base64url.parse(rawPayload, { loose: true })));\n  const signature = base64url.parse(rawSignature, { loose: true });\n\n  return {\n    header,\n    payload,\n    signature,\n    raw: {\n      header: rawHeader,\n      payload: rawPayload,\n      signature: rawSignature,\n      text: token,\n    },\n  };\n}\n\nexport type VerifyJwtOptions = {\n  audience?: string | string[];\n  authorizedParties?: string[];\n  /**\n   * @deprecated This option incorrectly accepts milliseconds instead of seconds and has been deprecated. Use clockSkewInMs instead.\n   */\n  clockSkewInSeconds?: number;\n  clockSkewInMs?: number;\n  issuer: IssuerResolver | string | null;\n  key: JsonWebKey;\n};\n\n// TODO: Revise the return types. Maybe it's better to throw an error instead of return an object with a reason\nexport async function verifyJwt(\n  token: string,\n  { audience, authorizedParties, clockSkewInSeconds, clockSkewInMs, issuer, key }: VerifyJwtOptions,\n): Promise<JwtPayload> {\n  const clockSkew = clockSkewInMs || clockSkewInSeconds || DEFAULT_CLOCK_SKEW_IN_SECONDS;\n\n  const decoded = decodeJwt(token);\n\n  const { header, payload } = decoded;\n\n  // Header verifications\n  const { typ, alg } = header;\n\n  // Verify type\n  if (typeof typ !== 'undefined' && typ !== 'JWT') {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.EnsureClerkJWT,\n      reason: TokenVerificationErrorReason.TokenInvalid,\n      message: `Invalid JWT type ${JSON.stringify(typ)}. Expected \"JWT\".`,\n    });\n  }\n\n  // Verify algorithm\n  if (!algToHash[alg]) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.EnsureClerkJWT,\n      reason: TokenVerificationErrorReason.TokenInvalidAlgorithm,\n      message: `Invalid JWT algorithm ${JSON.stringify(alg)}. Supported: ${algs}.`,\n    });\n  }\n\n  // Payload verifications\n  const { azp, sub, aud, iss, iat, exp, nbf } = payload;\n\n  // Verify subject claim (sub)\n  if (typeof sub !== 'string') {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.EnsureClerkJWT,\n      reason: TokenVerificationErrorReason.TokenVerificationFailed,\n      message: `Subject claim (sub) is required and must be a string. Received ${JSON.stringify(sub)}.`,\n    });\n  }\n\n  assertAudienceClaim([aud], [audience]);\n\n  // Verify authorized parties claim (azp)\n  if (azp && authorizedParties && authorizedParties.length > 0 && !authorizedParties.includes(azp)) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenInvalidAuthorizedParties,\n      message: `Invalid JWT Authorized party claim (azp) ${JSON.stringify(azp)}. Expected \"${authorizedParties}\".`,\n    });\n  }\n\n  // Verify issuer claim (iss)\n  if (typeof issuer === 'function' && !issuer(iss)) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenInvalidIssuer,\n      message: 'Failed JWT issuer resolver. Make sure that the resolver returns a truthy value.',\n    });\n  } else if (typeof issuer === 'string' && iss && iss !== issuer) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenInvalidIssuer,\n      message: `Invalid JWT issuer claim (iss) ${JSON.stringify(decoded.payload.iss)}. Expected \"${issuer}\".`,\n    });\n  }\n\n  // Verify expiration claim (exp)\n  if (typeof exp !== 'number') {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.EnsureClerkJWT,\n      reason: TokenVerificationErrorReason.TokenVerificationFailed,\n      message: `Invalid JWT expiry date claim (exp) ${JSON.stringify(exp)}. Expected number.`,\n    });\n  }\n  const currentDate = new Date(Date.now());\n  const expiryDate = new Date(0);\n  expiryDate.setUTCSeconds(exp);\n  const expired = expiryDate.getTime() <= currentDate.getTime() - clockSkew;\n  if (expired) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenExpired,\n      message: `JWT is expired. Expiry date: ${expiryDate}, Current date: ${currentDate}.`,\n    });\n  }\n\n  // Verify activation claim (nbf)\n  if (nbf !== undefined) {\n    if (typeof nbf !== 'number') {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.EnsureClerkJWT,\n        reason: TokenVerificationErrorReason.TokenVerificationFailed,\n        message: `Invalid JWT not before date claim (nbf) ${JSON.stringify(nbf)}. Expected number.`,\n      });\n    }\n    const notBeforeDate = new Date(0);\n    notBeforeDate.setUTCSeconds(nbf);\n    const early = notBeforeDate.getTime() > currentDate.getTime() + clockSkew;\n    if (early) {\n      throw new TokenVerificationError({\n        reason: TokenVerificationErrorReason.TokenNotActiveYet,\n        message: `JWT cannot be used prior to not before date claim (nbf). Not before date: ${notBeforeDate}; Current date: ${currentDate};`,\n      });\n    }\n  }\n\n  // Verify issued at claim (iat)\n  if (iat !== undefined) {\n    if (typeof iat !== 'number') {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.EnsureClerkJWT,\n        reason: TokenVerificationErrorReason.TokenVerificationFailed,\n        message: `Invalid JWT issued at date claim (iat) ${JSON.stringify(iat)}. Expected number.`,\n      });\n    }\n    const issuedAtDate = new Date(0);\n    issuedAtDate.setUTCSeconds(iat);\n    const postIssued = issuedAtDate.getTime() > currentDate.getTime() + clockSkew;\n    if (postIssued) {\n      throw new TokenVerificationError({\n        reason: TokenVerificationErrorReason.TokenNotActiveYet,\n        message: `JWT issued at date claim (iat) is in the future. Issued at date: ${issuedAtDate}; Current date: ${currentDate};`,\n      });\n    }\n  }\n\n  let signatureValid: boolean;\n\n  try {\n    signatureValid = await hasValidSignature(decoded, key);\n  } catch (err) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.EnsureClerkJWT,\n      reason: TokenVerificationErrorReason.TokenVerificationFailed,\n      message: `Error verifying JWT signature. ${err}`,\n    });\n  }\n\n  if (!signatureValid) {\n    throw new TokenVerificationError({\n      reason: TokenVerificationErrorReason.TokenInvalidSignature,\n      message: 'JWT signature is invalid.',\n    });\n  }\n\n  return payload;\n}\n","import { API_URL, API_VERSION, MAX_CACHE_LAST_UPDATED_AT_SECONDS } from '../constants';\n// DO NOT CHANGE: Runtime needs to be imported as a default export so that we can stub its dependencies with Sinon.js\n// For more information refer to https://sinonjs.org/how-to/stub-dependency/\nimport runtime from '../runtime';\nimport { callWithRetry } from '../util/callWithRetry';\nimport { joinPaths } from '../util/path';\nimport { getErrorObjectByCode } from '../util/request';\nimport {\n  TokenVerificationError,\n  TokenVerificationErrorAction,\n  TokenVerificationErrorCode,\n  TokenVerificationErrorReason,\n} from './errors';\n\ntype JsonWebKeyWithKid = JsonWebKey & { kid: string };\n\ntype JsonWebKeyCache = Record<string, JsonWebKeyWithKid>;\n\nlet cache: JsonWebKeyCache = {};\nlet lastUpdatedAt = 0;\n\nfunction getFromCache(kid: string) {\n  return cache[kid];\n}\n\nfunction setInCache(\n  jwk: JsonWebKeyWithKid,\n  jwksCacheTtlInMs: number = 1000 * 60 * 60, // 1 hour\n) {\n  cache[jwk.kid] = jwk;\n  lastUpdatedAt = Date.now();\n\n  if (jwksCacheTtlInMs >= 0) {\n    setTimeout(() => {\n      if (jwk) {\n        delete cache[jwk.kid];\n      } else {\n        cache = {};\n      }\n    }, jwksCacheTtlInMs);\n  }\n}\n\nconst LocalJwkKid = 'local';\nconst PEM_HEADER = '-----BEGIN PUBLIC KEY-----';\nconst PEM_TRAILER = '-----END PUBLIC KEY-----';\nconst RSA_PREFIX = 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA';\nconst RSA_SUFFIX = 'IDAQAB';\n\n/**\n *\n * Loads a local PEM key usually from process.env and transform it to JsonWebKey format.\n * The result is also cached on the module level to avoid unnecessary computations in subsequent invocations.\n *\n * @param {string} localKey\n * @returns {JsonWebKey} key\n */\nexport function loadClerkJWKFromLocal(localKey?: string): JsonWebKey {\n  if (!getFromCache(LocalJwkKid)) {\n    if (!localKey) {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.SetClerkJWTKey,\n        message: 'Missing local JWK.',\n        reason: TokenVerificationErrorReason.LocalJWKMissing,\n      });\n    }\n\n    const modulus = localKey\n      .replace(/(\\r\\n|\\n|\\r)/gm, '')\n      .replace(PEM_HEADER, '')\n      .replace(PEM_TRAILER, '')\n      .replace(RSA_PREFIX, '')\n      .replace(RSA_SUFFIX, '')\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_');\n\n    // JWK https://datatracker.ietf.org/doc/html/rfc7517\n    setInCache(\n      {\n        kid: 'local',\n        kty: 'RSA',\n        alg: 'RS256',\n        n: modulus,\n        e: 'AQAB',\n      },\n      -1, // local key never expires in cache\n    );\n  }\n\n  return getFromCache(LocalJwkKid);\n}\n\nexport type LoadClerkJWKFromRemoteOptions = {\n  kid: string;\n  jwksCacheTtlInMs?: number;\n  skipJwksCache?: boolean;\n  secretKey?: string;\n  /**\n   * @deprecated Use `secretKey` instead.\n   */\n  apiKey?: string;\n  apiUrl?: string;\n  apiVersion?: string;\n  issuer?: string;\n};\n\n/**\n *\n * Loads a key from JWKS retrieved from the well-known Frontend API endpoint of the issuer.\n * The result is also cached on the module level to avoid network requests in subsequent invocations.\n * The cache lasts 1 hour by default.\n *\n * @param {Object} options\n * @param {string} options.issuer - The issuer origin of the JWT\n * @param {string} options.kid - The id of the key that the JWT was signed with\n * @param {string} options.alg - The algorithm of the JWT\n * @param {number} options.jwksCacheTtlInMs - The TTL of the jwks cache (defaults to 1 hour)\n * @returns {JsonWebKey} key\n */\nexport async function loadClerkJWKFromRemote({\n  apiKey,\n  secretKey,\n  apiUrl = API_URL,\n  apiVersion = API_VERSION,\n  issuer,\n  kid,\n  jwksCacheTtlInMs = 1000 * 60 * 60, // 1 hour,\n  skipJwksCache,\n}: LoadClerkJWKFromRemoteOptions): Promise<JsonWebKey> {\n  const shouldRefreshCache = !getFromCache(kid) && reachedMaxCacheUpdatedAt();\n  if (skipJwksCache || shouldRefreshCache) {\n    let fetcher;\n    const key = secretKey || apiKey;\n\n    if (key) {\n      fetcher = () => fetchJWKSFromBAPI(apiUrl, key, apiVersion);\n    } else if (issuer) {\n      fetcher = () => fetchJWKSFromFAPI(issuer);\n    } else {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.ContactSupport,\n        message: 'Failed to load JWKS from Clerk Backend or Frontend API.',\n        reason: TokenVerificationErrorReason.RemoteJWKFailedToLoad,\n      });\n    }\n\n    const { keys }: { keys: JsonWebKeyWithKid[] } = await callWithRetry(fetcher);\n\n    if (!keys || !keys.length) {\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.ContactSupport,\n        message: 'The JWKS endpoint did not contain any signing keys. Contact support@clerk.com.',\n        reason: TokenVerificationErrorReason.RemoteJWKFailedToLoad,\n      });\n    }\n\n    keys.forEach(key => setInCache(key, jwksCacheTtlInMs));\n  }\n\n  const jwk = getFromCache(kid);\n\n  if (!jwk) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.ContactSupport,\n      message: `Unable to find a signing key in JWKS that matches the kid='${kid}' of the provided session token. Please make sure that the __session cookie or the HTTP authorization header contain a Clerk-generated session JWT.`,\n      reason: TokenVerificationErrorReason.RemoteJWKMissing,\n    });\n  }\n\n  return jwk;\n}\n\nasync function fetchJWKSFromFAPI(issuer: string) {\n  const url = new URL(issuer);\n  url.pathname = joinPaths(url.pathname, '.well-known/jwks.json');\n\n  const response = await runtime.fetch(url.href);\n\n  if (!response.ok) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.ContactSupport,\n      message: `Error loading Clerk JWKS from ${url.href} with code=${response.status}`,\n      reason: TokenVerificationErrorReason.RemoteJWKFailedToLoad,\n    });\n  }\n\n  return response.json();\n}\n\nasync function fetchJWKSFromBAPI(apiUrl: string, key: string, apiVersion: string) {\n  if (!key) {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.SetClerkSecretKeyOrAPIKey,\n      message:\n        'Missing Clerk Secret Key or API Key. Go to https://dashboard.clerk.com and get your key for your instance.',\n      reason: TokenVerificationErrorReason.RemoteJWKFailedToLoad,\n    });\n  }\n\n  const url = new URL(apiUrl);\n  url.pathname = joinPaths(url.pathname, apiVersion, '/jwks');\n\n  const response = await runtime.fetch(url.href, {\n    headers: {\n      Authorization: `Bearer ${key}`,\n      'Content-Type': 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    const json = await response.json();\n    const invalidSecretKeyError = getErrorObjectByCode(json?.errors, TokenVerificationErrorCode.InvalidSecretKey);\n\n    if (invalidSecretKeyError) {\n      const reason = TokenVerificationErrorReason.InvalidSecretKey;\n\n      throw new TokenVerificationError({\n        action: TokenVerificationErrorAction.ContactSupport,\n        message: invalidSecretKeyError.message,\n        reason,\n      });\n    }\n\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.ContactSupport,\n      message: `Error loading Clerk JWKS from ${url.href} with code=${response.status}`,\n      reason: TokenVerificationErrorReason.RemoteJWKFailedToLoad,\n    });\n  }\n\n  return response.json();\n}\n\nfunction reachedMaxCacheUpdatedAt() {\n  return Date.now() - lastUpdatedAt >= MAX_CACHE_LAST_UPDATED_AT_SECONDS * 1000;\n}\n","import type { JwtPayload } from '@clerk/types';\n\nimport { TokenVerificationError, TokenVerificationErrorAction, TokenVerificationErrorReason } from './errors';\nimport type { VerifyJwtOptions } from './jwt';\nimport { decodeJwt, verifyJwt } from './jwt';\nimport type { LoadClerkJWKFromRemoteOptions } from './keys';\nimport { loadClerkJWKFromLocal, loadClerkJWKFromRemote } from './keys';\n\n/**\n *\n */\nexport type VerifyTokenOptions = Pick<\n  VerifyJwtOptions,\n  'authorizedParties' | 'audience' | 'issuer' | 'clockSkewInSeconds' | 'clockSkewInMs'\n> & { jwtKey?: string; proxyUrl?: string } & Pick<\n    LoadClerkJWKFromRemoteOptions,\n    'apiKey' | 'secretKey' | 'apiUrl' | 'apiVersion' | 'jwksCacheTtlInMs' | 'skipJwksCache'\n  >;\n\nexport async function verifyToken(token: string, options: VerifyTokenOptions): Promise<JwtPayload> {\n  const {\n    apiKey,\n    secretKey,\n    apiUrl,\n    apiVersion,\n    audience,\n    authorizedParties,\n    clockSkewInSeconds,\n    clockSkewInMs,\n    issuer,\n    jwksCacheTtlInMs,\n    jwtKey,\n    skipJwksCache,\n  } = options;\n\n  const { header } = decodeJwt(token);\n  const { kid } = header;\n\n  let key;\n\n  if (jwtKey) {\n    key = loadClerkJWKFromLocal(jwtKey);\n  } else if (typeof issuer === 'string') {\n    // Fetch JWKS from Frontend API if an issuer of type string has been provided\n    key = await loadClerkJWKFromRemote({ issuer, kid, jwksCacheTtlInMs, skipJwksCache });\n  } else if (apiKey || secretKey) {\n    // Fetch JWKS from Backend API using the key\n    key = await loadClerkJWKFromRemote({ apiKey, secretKey, apiUrl, apiVersion, kid, jwksCacheTtlInMs, skipJwksCache });\n  } else {\n    throw new TokenVerificationError({\n      action: TokenVerificationErrorAction.SetClerkJWTKey,\n      message: 'Failed to resolve JWK during verification.',\n      reason: TokenVerificationErrorReason.JWKFailedToResolve,\n    });\n  }\n\n  return await verifyJwt(token, {\n    audience,\n    authorizedParties,\n    clockSkewInSeconds,\n    clockSkewInMs,\n    key,\n    issuer,\n  });\n}\n","import { isDevelopmentFromApiKey, isProductionFromApiKey } from '../util/instance';\nimport { checkCrossOrigin } from '../util/request';\nimport type { RequestState } from './authStatus';\nimport { AuthErrorReason, interstitial, signedIn, signedOut } from './authStatus';\nimport type { AuthenticateRequestOptions } from './request';\nimport { verifyToken } from './verify';\n\ntype InterstitialRuleResult = RequestState | undefined;\ntype InterstitialRule = <T extends AuthenticateRequestOptions>(\n  opts: T,\n) => Promise<InterstitialRuleResult> | InterstitialRuleResult;\n\nconst shouldRedirectToSatelliteUrl = (qp?: URLSearchParams) => !!qp?.get('__clerk_satellite_url');\nconst hasJustSynced = (qp?: URLSearchParams) => qp?.get('__clerk_synced') === 'true';\n/**\n * @deprecated This will be removed in the next minor version\n */\nconst isReturningFromPrimary = (qp?: URLSearchParams) => qp?.get('__clerk_referrer_primary') === 'true';\n\nconst VALID_USER_AGENTS = /^Mozilla\\/|(Amazon CloudFront)/;\n\nconst isBrowser = (userAgent: string | undefined) => VALID_USER_AGENTS.test(userAgent || '');\n\n// In development or staging environments only, based on the request's\n// User Agent, detect non-browser requests (e.g. scripts). Since there\n// is no Authorization header, consider the user as signed out and\n// prevent interstitial rendering\n// In production, script requests will be missing both uat and session cookies, which will be\n// automatically treated as signed out. This exception is needed for development, because the any // missing uat throws an interstitial in development.\nexport const nonBrowserRequestInDevRule: InterstitialRule = options => {\n  const { apiKey, secretKey, userAgent } = options;\n  const key = secretKey || apiKey || '';\n  if (isDevelopmentFromApiKey(key) && !isBrowser(userAgent)) {\n    return signedOut(options, AuthErrorReason.HeaderMissingNonBrowser);\n  }\n  return undefined;\n};\n\nexport const crossOriginRequestWithoutHeader: InterstitialRule = options => {\n  const { origin, host, forwardedHost, forwardedPort, forwardedProto } = options;\n  const isCrossOrigin =\n    origin &&\n    checkCrossOrigin({\n      originURL: new URL(origin),\n      host,\n      forwardedHost,\n      forwardedPort,\n      forwardedProto,\n    });\n\n  if (isCrossOrigin) {\n    return signedOut(options, AuthErrorReason.HeaderMissingCORS);\n  }\n  return undefined;\n};\n\nexport const isPrimaryInDevAndRedirectsToSatellite: InterstitialRule = options => {\n  const { apiKey, secretKey, isSatellite, searchParams } = options;\n  const key = secretKey || apiKey || '';\n  const isDev = isDevelopmentFromApiKey(key);\n\n  if (isDev && !isSatellite && shouldRedirectToSatelliteUrl(searchParams)) {\n    return interstitial(options, AuthErrorReason.PrimaryRespondsToSyncing);\n  }\n  return undefined;\n};\n\nexport const potentialFirstLoadInDevWhenUATMissing: InterstitialRule = options => {\n  const { apiKey, secretKey, clientUat } = options;\n  const key = secretKey || apiKey || '';\n  const res = isDevelopmentFromApiKey(key);\n  if (res && !clientUat) {\n    return interstitial(options, AuthErrorReason.CookieUATMissing);\n  }\n  return undefined;\n};\n\n/**\n * NOTE: Exclude any satellite app that has just synced from throwing an interstitial.\n * It is expected that a primary app will trigger a redirect back to the satellite app.\n */\nexport const potentialRequestAfterSignInOrOutFromClerkHostedUiInDev: InterstitialRule = options => {\n  const { apiKey, secretKey, referrer, host, forwardedHost, forwardedPort, forwardedProto } = options;\n  const crossOriginReferrer =\n    referrer && checkCrossOrigin({ originURL: new URL(referrer), host, forwardedHost, forwardedPort, forwardedProto });\n  const key = secretKey || apiKey || '';\n\n  if (isDevelopmentFromApiKey(key) && crossOriginReferrer) {\n    return interstitial(options, AuthErrorReason.CrossOriginReferrer);\n  }\n  return undefined;\n};\n\n/**\n * @deprecated This will be removed in the next minor version\n */\nexport const satelliteInDevReturningFromPrimary: InterstitialRule = options => {\n  const { apiKey, secretKey, isSatellite, searchParams } = options;\n\n  const key = secretKey || apiKey || '';\n\n  if (isSatellite && isReturningFromPrimary(searchParams) && isDevelopmentFromApiKey(key)) {\n    return interstitial(options, AuthErrorReason.SatelliteReturnsFromPrimary);\n  }\n  return undefined;\n};\n\nexport const potentialFirstRequestOnProductionEnvironment: InterstitialRule = options => {\n  const { apiKey, secretKey, clientUat, cookieToken } = options;\n  const key = secretKey || apiKey || '';\n\n  if (isProductionFromApiKey(key) && !clientUat && !cookieToken) {\n    return signedOut(options, AuthErrorReason.CookieAndUATMissing);\n  }\n  return undefined;\n};\n\n// TBD: Can enable if we do not want the __session cookie to be inspected.\n// const signedOutOnDifferentSubdomainButCookieNotRemovedYet: AuthStateRule = (options, key) => {\n//   if (isProduction(key) && !options.clientUat && !options.cookieToken) {\n//     return { status: AuthStatus.Interstitial, errorReason: '' as any };\n//   }\n// };\nexport const isNormalSignedOutState: InterstitialRule = options => {\n  const { clientUat } = options;\n  if (clientUat === '0') {\n    return signedOut(options, AuthErrorReason.StandardSignedOut);\n  }\n  return undefined;\n};\n\n// This happens when a signed in user visits a new subdomain for the first time. The uat will be available because it's set on naked domain, but session will be missing. It can also happen if the cookieToken is manually removed during development.\nexport const hasPositiveClientUatButCookieIsMissing: InterstitialRule = options => {\n  const { clientUat, cookieToken } = options;\n\n  if (clientUat && Number.parseInt(clientUat) > 0 && !cookieToken) {\n    return interstitial(options, AuthErrorReason.CookieMissing);\n  }\n  return undefined;\n};\n\nexport const hasValidHeaderToken: InterstitialRule = async options => {\n  const { headerToken } = options as any;\n  const sessionClaims = await verifyRequestState(options, headerToken);\n  return await signedIn(options, sessionClaims);\n};\n\nexport const hasValidCookieToken: InterstitialRule = async options => {\n  const { cookieToken, clientUat } = options as any;\n  const sessionClaims = await verifyRequestState(options, cookieToken);\n  const state = await signedIn(options, sessionClaims);\n\n  const jwt = state.toAuth().sessionClaims;\n  const cookieTokenIsOutdated = jwt.iat < Number.parseInt(clientUat);\n\n  if (!clientUat || cookieTokenIsOutdated) {\n    return interstitial(options, AuthErrorReason.CookieOutDated);\n  }\n\n  return state;\n};\n\nexport async function runInterstitialRules<T extends AuthenticateRequestOptions>(\n  opts: T,\n  rules: InterstitialRule[],\n): Promise<RequestState> {\n  for (const rule of rules) {\n    const res = await rule(opts);\n    if (res) {\n      return res;\n    }\n  }\n\n  return signedOut(opts, AuthErrorReason.UnexpectedError);\n}\n\nasync function verifyRequestState(options: AuthenticateRequestOptions, token: string) {\n  const { isSatellite, proxyUrl } = options;\n  let issuer;\n  if (isSatellite) {\n    issuer = null;\n  } else if (proxyUrl) {\n    issuer = proxyUrl;\n  } else {\n    issuer = (iss: string) => iss.startsWith('https://clerk.') || iss.includes('.clerk.accounts');\n  }\n\n  return verifyToken(token, { ...options, issuer });\n}\n\n/**\n * Avoid throwing this rule for development instances\n * Let the next rule for UatMissing to fire if needed\n */\nexport const isSatelliteAndNeedsSyncing: InterstitialRule = options => {\n  const { clientUat, isSatellite, searchParams, userAgent } = options;\n\n  const isSignedOut = !clientUat || clientUat === '0';\n\n  if (isSatellite && isSignedOut && !isBrowser(userAgent)) {\n    return signedOut(options, AuthErrorReason.SatelliteCookieNeedsSyncing);\n  }\n\n  if (isSatellite && isSignedOut && !hasJustSynced(searchParams)) {\n    return interstitial(options, AuthErrorReason.SatelliteCookieNeedsSyncing);\n  }\n\n  return undefined;\n};\n","import { API_URL, API_VERSION } from '../constants';\nimport { assertValidSecretKey } from '../util/assertValidSecretKey';\nimport { isDevelopmentFromApiKey } from '../util/instance';\nimport { parsePublishableKey } from '../util/parsePublishableKey';\nimport type { RequestState } from './authStatus';\nimport { AuthErrorReason, interstitial, signedOut, unknownState } from './authStatus';\nimport type { TokenCarrier } from './errors';\nimport { TokenVerificationError, TokenVerificationErrorReason } from './errors';\nimport {\n  crossOriginRequestWithoutHeader,\n  hasPositiveClientUatButCookieIsMissing,\n  hasValidCookieToken,\n  hasValidHeaderToken,\n  isNormalSignedOutState,\n  isPrimaryInDevAndRedirectsToSatellite,\n  isSatelliteAndNeedsSyncing,\n  nonBrowserRequestInDevRule,\n  potentialFirstLoadInDevWhenUATMissing,\n  potentialFirstRequestOnProductionEnvironment,\n  potentialRequestAfterSignInOrOutFromClerkHostedUiInDev,\n  runInterstitialRules,\n  satelliteInDevReturningFromPrimary,\n} from './interstitialRule';\nimport type { VerifyTokenOptions } from './verify';\n\nexport type LoadResourcesOptions = {\n  loadSession?: boolean;\n  loadUser?: boolean;\n  loadOrganization?: boolean;\n};\n\nexport type RequiredVerifyTokenOptions = Required<\n  Pick<VerifyTokenOptions, 'apiKey' | 'secretKey' | 'apiUrl' | 'apiVersion'>\n>;\n\nexport type OptionalVerifyTokenOptions = Partial<\n  Pick<\n    VerifyTokenOptions,\n    | 'audience'\n    | 'authorizedParties'\n    | 'clockSkewInSeconds'\n    | 'clockSkewInMs'\n    | 'jwksCacheTtlInMs'\n    | 'skipJwksCache'\n    | 'jwtKey'\n  >\n>;\n\nexport type AuthenticateRequestOptions = OptionalVerifyTokenOptions &\n  LoadResourcesOptions & {\n    publishableKey?: string;\n    secretKey?: string;\n    /**\n     * @deprecated Use `publishableKey` instead.\n     */\n    frontendApi?: string;\n    /**\n     * @deprecated Use `secretKey` instead.\n     */\n    apiKey?: string;\n    apiVersion?: string;\n    apiUrl?: string;\n    /* Client token cookie value */\n    cookieToken?: string;\n    /* Client uat cookie value */\n    clientUat?: string;\n    /* Client token header value */\n    headerToken?: string;\n    /* Request origin header value */\n    origin?: string;\n    /* Request host header value */\n    host?: string;\n    /* Request forwarded host value */\n    forwardedHost?: string;\n    /* Request forwarded port value */\n    forwardedPort?: string;\n    /* Request forwarded proto value */\n    forwardedProto?: string;\n    /* Request referrer */\n    referrer?: string;\n    /* Request user-agent value */\n    userAgent?: string;\n    /**\n     * @experimental\n     */\n    domain?: string;\n    /**\n     * @experimental\n     */\n    isSatellite?: boolean;\n    /**\n     * @experimental\n     */\n    proxyUrl?: string;\n    /**\n     * @experimental\n     */\n    searchParams?: URLSearchParams;\n    /**\n     * @experimental\n     */\n    signInUrl?: string;\n  };\n\nfunction assertSignInUrlExists(signInUrl: string | undefined, key: string): asserts signInUrl is string {\n  if (!signInUrl && isDevelopmentFromApiKey(key)) {\n    throw new Error(`Missing signInUrl. Pass a signInUrl for dev instances if an app is satellite`);\n  }\n}\n\nfunction assertProxyUrlOrDomain(proxyUrlOrDomain: string | undefined) {\n  if (!proxyUrlOrDomain) {\n    throw new Error(`Missing domain and proxyUrl. A satellite application needs to specify a domain or a proxyUrl`);\n  }\n}\n\nexport async function authenticateRequest(options: AuthenticateRequestOptions): Promise<RequestState> {\n  options.frontendApi = parsePublishableKey(options.publishableKey)?.frontendApi || options.frontendApi || '';\n  options.apiUrl = options.apiUrl || API_URL;\n  options.apiVersion = options.apiVersion || API_VERSION;\n  options.headerToken = options.headerToken?.replace('Bearer ', '');\n\n  assertValidSecretKey(options.secretKey || options.apiKey);\n\n  if (options.isSatellite) {\n    assertSignInUrlExists(options.signInUrl, (options.secretKey || options.apiKey) as string);\n    assertProxyUrlOrDomain(options.proxyUrl || options.domain);\n  }\n\n  async function authenticateRequestWithTokenInHeader() {\n    try {\n      const state = await runInterstitialRules(options, [hasValidHeaderToken]);\n      return state;\n    } catch (err) {\n      return handleError(err, 'header');\n    }\n  }\n\n  async function authenticateRequestWithTokenInCookie() {\n    try {\n      const state = await runInterstitialRules(options, [\n        crossOriginRequestWithoutHeader,\n        nonBrowserRequestInDevRule,\n        isSatelliteAndNeedsSyncing,\n        satelliteInDevReturningFromPrimary,\n        isPrimaryInDevAndRedirectsToSatellite,\n        potentialFirstRequestOnProductionEnvironment,\n        potentialFirstLoadInDevWhenUATMissing,\n        potentialRequestAfterSignInOrOutFromClerkHostedUiInDev,\n        hasPositiveClientUatButCookieIsMissing,\n        isNormalSignedOutState,\n        hasValidCookieToken,\n      ]);\n\n      return state;\n    } catch (err) {\n      return handleError(err, 'cookie');\n    }\n  }\n\n  function handleError(err: unknown, tokenCarrier: TokenCarrier) {\n    if (err instanceof TokenVerificationError) {\n      err.tokenCarrier = tokenCarrier;\n\n      const reasonToReturnInterstitial = [\n        TokenVerificationErrorReason.TokenExpired,\n        TokenVerificationErrorReason.TokenNotActiveYet,\n      ].includes(err.reason);\n\n      if (reasonToReturnInterstitial) {\n        if (tokenCarrier === 'header') {\n          return unknownState<AuthenticateRequestOptions>(options, err.reason, err.getFullMessage());\n        }\n        return interstitial<AuthenticateRequestOptions>(options, err.reason, err.getFullMessage());\n      }\n      return signedOut<AuthenticateRequestOptions>(options, err.reason, err.getFullMessage());\n    }\n    return signedOut<AuthenticateRequestOptions>(options, AuthErrorReason.UnexpectedError, (err as Error).message);\n  }\n\n  if (options.headerToken) {\n    return authenticateRequestWithTokenInHeader();\n  }\n  return authenticateRequestWithTokenInCookie();\n}\n\nexport const debugRequestState = (params: RequestState) => {\n  const { frontendApi, isSignedIn, proxyUrl, isInterstitial, reason, message, publishableKey, isSatellite, domain } =\n    params;\n  return { frontendApi, isSignedIn, proxyUrl, isInterstitial, reason, message, publishableKey, isSatellite, domain };\n};\n\nexport type DebugRequestSate = ReturnType<typeof debugRequestState>;\n","import type { ApiClient } from '../api';\nimport { API_URL, API_VERSION } from '../constants';\nimport type { LoadInterstitialOptions } from './interstitial';\nimport { buildPublicInterstitialUrl, loadInterstitialFromBAPI, loadInterstitialFromLocal } from './interstitial';\nimport type { AuthenticateRequestOptions } from './request';\nimport { authenticateRequest as authenticateRequestOriginal, debugRequestState } from './request';\n\nexport type CreateAuthenticateRequestOptions = {\n  options: Partial<\n    Pick<\n      AuthenticateRequestOptions,\n      | 'audience'\n      | 'apiKey'\n      | 'secretKey'\n      | 'apiUrl'\n      | 'apiVersion'\n      | 'frontendApi'\n      | 'publishableKey'\n      | 'jwtKey'\n      | 'proxyUrl'\n      | 'domain'\n      | 'isSatellite'\n    >\n  >;\n  apiClient: ApiClient;\n};\n\nexport function createAuthenticateRequest(params: CreateAuthenticateRequestOptions) {\n  const { apiClient } = params;\n  const {\n    apiKey: buildtimeApiKey = '',\n    secretKey: buildtimeSecretKey = '',\n    jwtKey: buildtimeJwtKey = '',\n    apiUrl = API_URL,\n    apiVersion = API_VERSION,\n    frontendApi: buildtimeFrontendApi = '',\n    proxyUrl: buildProxyUrl = '',\n    publishableKey: buildtimePublishableKey = '',\n    isSatellite: buildtimeIsSatellite = false,\n    domain: buildtimeDomain = '',\n    audience: buildtimeAudience = '',\n  } = params.options;\n\n  const authenticateRequest = ({\n    apiKey: runtimeApiKey,\n    secretKey: runtimeSecretKey,\n    audience: runtimeAudience,\n    frontendApi: runtimeFrontendApi,\n    proxyUrl: runtimeProxyUrl,\n    publishableKey: runtimePublishableKey,\n    jwtKey: runtimeJwtKey,\n    isSatellite: runtimeIsSatellite,\n    domain: runtimeDomain,\n    searchParams,\n    ...rest\n  }: Omit<AuthenticateRequestOptions, 'apiUrl' | 'apiVersion'>) => {\n    return authenticateRequestOriginal({\n      ...rest,\n      apiKey: runtimeApiKey || buildtimeApiKey,\n      secretKey: runtimeSecretKey || buildtimeSecretKey,\n      audience: runtimeAudience || buildtimeAudience,\n      apiUrl,\n      apiVersion,\n      frontendApi: runtimeFrontendApi || buildtimeFrontendApi,\n      proxyUrl: runtimeProxyUrl || buildProxyUrl,\n      publishableKey: runtimePublishableKey || buildtimePublishableKey,\n      isSatellite: runtimeIsSatellite || buildtimeIsSatellite,\n      domain: runtimeDomain || buildtimeDomain,\n      jwtKey: runtimeJwtKey || buildtimeJwtKey,\n      searchParams,\n    });\n  };\n\n  const localInterstitial = ({\n    frontendApi: runtimeFrontendApi,\n    publishableKey: runtimePublishableKey,\n    proxyUrl: runtimeProxyUrl,\n    isSatellite: runtimeIsSatellite,\n    domain: runtimeDomain,\n    ...rest\n  }: Omit<LoadInterstitialOptions, 'apiUrl'>) =>\n    loadInterstitialFromLocal({\n      ...rest,\n      frontendApi: runtimeFrontendApi || buildtimeFrontendApi,\n      proxyUrl: runtimeProxyUrl || buildProxyUrl,\n      publishableKey: runtimePublishableKey || buildtimePublishableKey,\n      isSatellite: runtimeIsSatellite || buildtimeIsSatellite,\n      domain: runtimeDomain || buildtimeDomain,\n    });\n\n  const remotePublicInterstitial = ({\n    frontendApi: runtimeFrontendApi,\n    publishableKey: runtimePublishableKey,\n    proxyUrl: runtimeProxyUrl,\n    isSatellite: runtimeIsSatellite,\n    domain: runtimeDomain,\n    ...rest\n  }: LoadInterstitialOptions) => {\n    return loadInterstitialFromBAPI({\n      ...rest,\n      apiUrl,\n      frontendApi: runtimeFrontendApi || buildtimeFrontendApi,\n      publishableKey: runtimePublishableKey || buildtimePublishableKey,\n      proxyUrl: (runtimeProxyUrl || buildProxyUrl) as any,\n      isSatellite: runtimeIsSatellite || buildtimeIsSatellite,\n      domain: (runtimeDomain || buildtimeDomain) as any,\n    });\n  };\n\n  const remotePublicInterstitialUrl = buildPublicInterstitialUrl;\n\n  // TODO: Replace this function with remotePublicInterstitial\n  const remotePrivateInterstitial = () => apiClient.interstitial.getInterstitial();\n\n  return {\n    authenticateRequest,\n    localInterstitial,\n    remotePublicInterstitial,\n    remotePrivateInterstitial,\n    remotePublicInterstitialUrl,\n    debugRequestState,\n  };\n}\n","import { parsePublishableKey } from './util/parsePublishableKey';\n\ntype RedirectAdapter = (url: string) => any;\n\ntype SignUpParams = { returnBackUrl?: string };\ntype SignInParams = { returnBackUrl?: string };\n\nconst buildUrl = (targetUrl: string, redirectUrl?: string) => {\n  let url;\n  if (!targetUrl.startsWith('http')) {\n    if (!redirectUrl || !redirectUrl.startsWith('http')) {\n      throw new Error('destination url or return back url should be an absolute path url!');\n    }\n\n    const baseURL = new URL(redirectUrl);\n    url = new URL(targetUrl, baseURL.origin);\n  } else {\n    url = new URL(targetUrl);\n  }\n\n  if (redirectUrl) {\n    url.searchParams.set('redirect_url', redirectUrl);\n  }\n\n  return url.toString();\n};\n\ntype RedirectParams = {\n  redirectAdapter: RedirectAdapter;\n  signInUrl?: string;\n  signUpUrl?: string;\n  publishableKey?: string;\n  /**\n   * @deprecated Use `publishableKey` instead.\n   */\n  frontendApi?: string;\n};\n\n// TODO: replace it with @clerk/shared errorThrower.throwMissingPublishableKeyError()\nconst missingPublishableKeyErrorMessage = `Missing publishableKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys.`;\n\nexport function redirect({ redirectAdapter, signUpUrl, signInUrl, frontendApi, publishableKey }: RedirectParams) {\n  if (!frontendApi) {\n    frontendApi = parsePublishableKey(publishableKey)?.frontendApi;\n  }\n\n  const accountsBaseUrl = buildAccountsBaseUrl(frontendApi);\n\n  const redirectToSignUp = ({ returnBackUrl }: SignUpParams = {}) => {\n    if (!signUpUrl && !accountsBaseUrl) {\n      throw new Error(missingPublishableKeyErrorMessage);\n    }\n\n    const accountsSignUpUrl = `${accountsBaseUrl}/sign-up`;\n    return redirectAdapter(buildUrl(signUpUrl || accountsSignUpUrl, returnBackUrl));\n  };\n\n  const redirectToSignIn = ({ returnBackUrl }: SignInParams = {}) => {\n    if (!signInUrl && !accountsBaseUrl) {\n      throw new Error(missingPublishableKeyErrorMessage);\n    }\n\n    const accountsSignInUrl = `${accountsBaseUrl}/sign-in`;\n    return redirectAdapter(buildUrl(signInUrl || accountsSignInUrl, returnBackUrl));\n  };\n\n  return { redirectToSignUp, redirectToSignIn };\n}\n\nfunction buildAccountsBaseUrl(frontendApi?: string) {\n  if (!frontendApi) {\n    return '';\n  }\n\n  // convert url from FAPI to accounts for Kima and legacy (prod & dev) instances\n  const accountsBaseUrl = frontendApi\n    // staging accounts\n    .replace(/(clerk\\.accountsstage\\.)/, 'accountsstage.')\n    .replace(/(clerk\\.accounts\\.|clerk\\.)/, 'accounts.');\n  return `https://${accountsBaseUrl}`;\n}\n"],"mappings":"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","names":["src_exports","__export","AllowlistIdentifier","AuthStatus","Clerk","Client","DeletedObject","Email","EmailAddress","ExternalAccount","IdentificationLink","Invitation","OauthAccessToken","ObjectType","Organization","OrganizationInvitation","OrganizationMembership","OrganizationMembershipPublicUserData","PhoneNumber","RedirectUrl","SMSMessage","Session","SignInToken","Token","User","Verification","constants","createAuthenticateRequest","debugRequestState","decodeJwt","deserialize","hasValidSignature","loadInterstitialFromLocal","makeAuthObjectSerializable","prunePrivateMetadata","redirect","sanitizeAuthObject","signedInAuthObject","signedOutAuthObject","verifyJwt","verifyToken","__toCommonJS","AbstractAPI","request","id","SEPARATOR","MULTIPLE_SEPARATOR_REGEX","joinPaths","args","p","basePath","AllowlistIdentifierAPI","AbstractAPI","params","allowlistIdentifierId","joinPaths","basePath","ClientAPI","AbstractAPI","clientId","joinPaths","token","basePath","DomainAPI","AbstractAPI","id","joinPaths","basePath","EmailAddressAPI","AbstractAPI","emailAddressId","joinPaths","params","basePath","EmailAPI","AbstractAPI","params","InterstitialAPI","AbstractAPI","basePath","InvitationAPI","AbstractAPI","params","invitationId","joinPaths","basePath","OrganizationAPI","AbstractAPI","params","organizationIdOrSlug","joinPaths","organizationId","limit","offset","userId","role","publicMetadata","privateMetadata","bodyParams","invitationId","requestingUserId","basePath","PhoneNumberAPI","AbstractAPI","phoneNumberId","joinPaths","params","basePath","RedirectUrlAPI","AbstractAPI","redirectUrlId","joinPaths","params","basePath","SessionAPI","AbstractAPI","queryParams","sessionId","joinPaths","token","template","basePath","SignInTokenAPI","AbstractAPI","params","signInTokenId","joinPaths","basePath","SMSMessageAPI","AbstractAPI","params","basePath","UserAPI","AbstractAPI","params","userId","joinPaths","provider","limit","offset","password","code","import_deepmerge","import_snakecase_keys","API_URL","API_VERSION","USER_AGENT","Attributes","Cookies","Headers","SearchParams","ContentTypes","constants","import_crypto","import_fetch","globalFetch","fetch","runtime","crypto","runtime_default","assertValidSecretKey","val","AllowlistIdentifier","id","identifier","createdAt","updatedAt","invitationId","data","Session","id","clientId","userId","status","lastActiveAt","expireAt","abandonAt","createdAt","updatedAt","data","Client","id","sessionIds","sessions","signInId","signUpId","lastActiveSessionId","createdAt","updatedAt","data","x","Session","DeletedObject","object","id","slug","deleted","data","Email","id","fromEmailName","emailAddressId","toEmailAddress","subject","body","bodyPlain","status","slug","data","deliveredByClerk","IdentificationLink","id","type","data","Verification","status","strategy","externalVerificationRedirectURL","attempts","expireAt","nonce","data","EmailAddress","id","emailAddress","verification","linkedTo","data","Verification","link","IdentificationLink","ExternalAccount","id","provider","identificationId","externalId","approvedScopes","emailAddress","firstName","lastName","picture","imageUrl","username","publicMetadata","label","verification","data","Verification","Invitation","id","emailAddress","publicMetadata","createdAt","updatedAt","status","revoked","data","ObjectType","OauthAccessToken","provider","token","publicMetadata","label","scopes","tokenSecret","data","Organization","id","name","slug","logoUrl","imageUrl","createdBy","createdAt","updatedAt","publicMetadata","privateMetadata","maxAllowedMemberships","data","OrganizationInvitation","id","emailAddress","role","organizationId","createdAt","updatedAt","status","publicMetadata","data","OrganizationMembership","id","role","publicMetadata","privateMetadata","createdAt","updatedAt","organization","publicUserData","data","Organization","OrganizationMembershipPublicUserData","identifier","firstName","lastName","profileImageUrl","imageUrl","userId","PhoneNumber","id","phoneNumber","reservedForSecondFactor","defaultSecondFactor","verification","linkedTo","data","Verification","link","IdentificationLink","RedirectUrl","id","url","createdAt","updatedAt","data","SignInToken","id","userId","token","status","url","createdAt","updatedAt","data","SMSMessage","id","fromPhoneNumber","toPhoneNumber","message","status","phoneNumberId","data","Token","jwt","data","Web3Wallet","id","web3Wallet","verification","data","Verification","User","id","passwordEnabled","totpEnabled","backupCodeEnabled","twoFactorEnabled","banned","createdAt","updatedAt","profileImageUrl","imageUrl","gender","birthday","primaryEmailAddressId","primaryPhoneNumberId","primaryWeb3WalletId","lastSignInAt","externalId","username","firstName","lastName","publicMetadata","privateMetadata","unsafeMetadata","emailAddresses","phoneNumbers","web3Wallets","externalAccounts","data","x","EmailAddress","PhoneNumber","Web3Wallet","ExternalAccount","deserialize","payload","item","jsonToObject","isPaginated","getCount","DeletedObject","AllowlistIdentifier","Client","EmailAddress","Email","Invitation","OauthAccessToken","Organization","OrganizationInvitation","OrganizationMembership","PhoneNumber","RedirectUrl","SignInToken","Session","SMSMessage","Token","User","withLegacyReturn","cb","args","data","errors","status","statusText","ClerkAPIResponseError","buildRequest","options","requestOptions","apiKey","secretKey","apiUrl","API_URL","apiVersion","API_VERSION","userAgent","USER_AGENT","httpOptions","path","method","queryParams","headerParams","bodyParams","key","assertValidSecretKey","url","joinPaths","finalUrl","snakecasedQueryParams","snakecaseKeys","val","v","headers","body","res","runtime_default","deepmerge","deserialize","err","parseErrors","parseError","error","message","createBackendApiClient","options","request","buildRequest","AllowlistIdentifierAPI","ClientAPI","EmailAddressAPI","EmailAPI","InterstitialAPI","InvitationAPI","OrganizationAPI","PhoneNumberAPI","RedirectUrlAPI","SessionAPI","SignInTokenAPI","SMSMessageAPI","UserAPI","DomainAPI","createDebug","data","res","signedInAuthObject","sessionClaims","options","debugData","actor","sessionId","orgId","orgRole","orgSlug","userId","apiKey","secretKey","apiUrl","apiVersion","token","session","user","organization","sessions","createBackendApiClient","getToken","createGetToken","args","signedOutAuthObject","prunePrivateMetadata","resource","sanitizeAuthObject","authObject","makeAuthObjectSerializable","obj","debug","rest","params","fetcher","sessionToken","wait","ms","res","MAX_NUMBER_OF_RETRIES","callWithRetry","fn","attempt","maxAttempts","e","isDevelopmentFromApiKey","apiKey","isProductionFromApiKey","isStaging","frontendApi","createDevOrStagingUrlCache","DEV_OR_STAGING_SUFFIXES","devOrStagingUrlCache","url","hostname","res","isDevOrStagingUrl","PUBLISHABLE_KEY_LIVE_PREFIX","PUBLISHABLE_KEY_TEST_PREFIX","parsePublishableKey","key","isPublishableKey","instanceType","PUBLISHABLE_KEY_LIVE_PREFIX","frontendApi","isomorphicAtob","hasValidPrefix","PUBLISHABLE_KEY_TEST_PREFIX","hasValidFrontendApiPostfix","data","TokenVerificationError","action","message","reason","m","addClerkPrefix","str","regex","loadInterstitialFromLocal","options","parsePublishableKey","domainOnlyInProd","isDevOrStagingUrl","debugData","frontendApi","pkgVersion","clerkJSUrl","clerkJSVersion","publishableKey","proxyUrl","isSatellite","domain","signInUrl","getScriptUrl","loadInterstitialFromBAPI","url","buildPublicInterstitialUrl","response","callWithRetry","runtime_default","TokenVerificationError","apiUrl","joinPaths","API_VERSION","getClerkJsMajorVersionOrTag","isStaging","noSchemeFrontendApi","major","AuthStatus","signedIn","options","sessionClaims","apiKey","secretKey","apiUrl","apiVersion","cookieToken","frontendApi","proxyUrl","publishableKey","domain","isSatellite","headerToken","loadSession","loadUser","loadOrganization","signInUrl","sessionId","orgId","userId","sessions","users","organizations","createBackendApiClient","sessionResp","userResp","organizationResp","authObject","signedInAuthObject","signedOut","reason","message","signedOutAuthObject","interstitial","unknownState","checkCrossOrigin","originURL","host","forwardedHost","forwardedPort","forwardedProto","fwdProto","getFirstValueFromHeaderValue","fwdPort","fwdProtoHasMoreValuesThanFwdPorts","getPortFromProtocol","originProtocol","getProtocolVerb","finalURL","convertHostHeaderValueToURL","getPort","protocol","PROTOCOL_TO_PORT_MAPPING","url","value","getErrorObjectByCode","errors","code","err","base64url","string","opts","parse","base64UrlEncoding","data","stringify","encoding","i","end","out","bits","buffer","written","value","pad","mask","isArrayString","s","a","assertAudienceClaim","aud","audience","audienceList","audList","TokenVerificationError","DEFAULT_CLOCK_SKEW_IN_SECONDS","algToHash","RSA_ALGORITHM_NAME","EC_ALGORITHM_NAME","jwksAlgToCryptoAlg","algs","hasValidSignature","jwt","jwk","header","signature","raw","data","cryptoKey","runtime_default","decodeJwt","token","tokenParts","TokenVerificationError","rawHeader","rawPayload","rawSignature","decoder","base64url","payload","verifyJwt","audience","authorizedParties","clockSkewInSeconds","clockSkewInMs","issuer","key","clockSkew","decoded","typ","alg","azp","sub","aud","iss","iat","exp","nbf","assertAudienceClaim","currentDate","expiryDate","notBeforeDate","issuedAtDate","signatureValid","err","cache","lastUpdatedAt","getFromCache","kid","setInCache","jwk","jwksCacheTtlInMs","LocalJwkKid","PEM_HEADER","PEM_TRAILER","RSA_PREFIX","RSA_SUFFIX","loadClerkJWKFromLocal","localKey","TokenVerificationError","modulus","loadClerkJWKFromRemote","apiKey","secretKey","apiUrl","API_URL","apiVersion","API_VERSION","issuer","skipJwksCache","shouldRefreshCache","reachedMaxCacheUpdatedAt","fetcher","key","fetchJWKSFromBAPI","fetchJWKSFromFAPI","keys","callWithRetry","url","joinPaths","response","runtime_default","json","invalidSecretKeyError","getErrorObjectByCode","reason","verifyToken","token","options","apiKey","secretKey","apiUrl","apiVersion","audience","authorizedParties","clockSkewInSeconds","clockSkewInMs","issuer","jwksCacheTtlInMs","jwtKey","skipJwksCache","header","decodeJwt","kid","key","loadClerkJWKFromLocal","loadClerkJWKFromRemote","TokenVerificationError","verifyJwt","shouldRedirectToSatelliteUrl","qp","hasJustSynced","isReturningFromPrimary","VALID_USER_AGENTS","isBrowser","userAgent","nonBrowserRequestInDevRule","options","apiKey","secretKey","isDevelopmentFromApiKey","signedOut","crossOriginRequestWithoutHeader","origin","host","forwardedHost","forwardedPort","forwardedProto","checkCrossOrigin","isPrimaryInDevAndRedirectsToSatellite","isSatellite","searchParams","interstitial","potentialFirstLoadInDevWhenUATMissing","clientUat","potentialRequestAfterSignInOrOutFromClerkHostedUiInDev","referrer","crossOriginReferrer","satelliteInDevReturningFromPrimary","key","potentialFirstRequestOnProductionEnvironment","cookieToken","isProductionFromApiKey","isNormalSignedOutState","hasPositiveClientUatButCookieIsMissing","hasValidHeaderToken","headerToken","sessionClaims","verifyRequestState","signedIn","hasValidCookieToken","state","cookieTokenIsOutdated","runInterstitialRules","opts","rules","rule","res","token","proxyUrl","issuer","iss","verifyToken","isSatelliteAndNeedsSyncing","isSignedOut","assertSignInUrlExists","signInUrl","key","isDevelopmentFromApiKey","assertProxyUrlOrDomain","proxyUrlOrDomain","authenticateRequest","options","parsePublishableKey","API_URL","API_VERSION","assertValidSecretKey","authenticateRequestWithTokenInHeader","runInterstitialRules","hasValidHeaderToken","err","handleError","authenticateRequestWithTokenInCookie","crossOriginRequestWithoutHeader","nonBrowserRequestInDevRule","isSatelliteAndNeedsSyncing","satelliteInDevReturningFromPrimary","isPrimaryInDevAndRedirectsToSatellite","potentialFirstRequestOnProductionEnvironment","potentialFirstLoadInDevWhenUATMissing","potentialRequestAfterSignInOrOutFromClerkHostedUiInDev","hasPositiveClientUatButCookieIsMissing","isNormalSignedOutState","hasValidCookieToken","tokenCarrier","TokenVerificationError","unknownState","interstitial","signedOut","debugRequestState","params","frontendApi","isSignedIn","proxyUrl","isInterstitial","reason","message","publishableKey","isSatellite","domain","createAuthenticateRequest","params","apiClient","buildtimeApiKey","buildtimeSecretKey","buildtimeJwtKey","apiUrl","API_URL","apiVersion","API_VERSION","buildtimeFrontendApi","buildProxyUrl","buildtimePublishableKey","buildtimeIsSatellite","buildtimeDomain","buildtimeAudience","runtimeApiKey","runtimeSecretKey","runtimeAudience","runtimeFrontendApi","runtimeProxyUrl","runtimePublishableKey","runtimeJwtKey","runtimeIsSatellite","runtimeDomain","searchParams","rest","authenticateRequest","loadInterstitialFromLocal","loadInterstitialFromBAPI","buildPublicInterstitialUrl","debugRequestState","buildUrl","targetUrl","redirectUrl","url","baseURL","missingPublishableKeyErrorMessage","redirect","redirectAdapter","signUpUrl","signInUrl","frontendApi","publishableKey","parsePublishableKey","accountsBaseUrl","buildAccountsBaseUrl","returnBackUrl","accountsSignUpUrl","accountsSignInUrl","Clerk","options","opts","apiClient","createBackendApiClient","requestState","createAuthenticateRequest"]}